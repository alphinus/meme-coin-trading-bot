---
phase: 03-documentation-engine
plan: 04
type: execute
wave: 3
depends_on: ["03-02", "03-03"]
files_modified:
  - client/src/App.tsx
  - client/src/components/SoulDocumentNav.tsx
autonomous: false

must_haves:
  truths:
    - "User can navigate to their own Soul Document from the app header"
    - "User can navigate to other team members' Soul Documents"
    - "User can navigate to the Meta Soul Document from the Soul Document area"
    - "Soul Document page loads and renders real entries from the API"
    - "Meta Soul Document page loads and shows team-level aggregation"
    - "All Soul Document routes are protected (require authentication)"
  artifacts:
    - path: "client/src/App.tsx"
      provides: "Routes for /soul/:userId and /soul/meta/:teamId"
      contains: "SoulDocument"
    - path: "client/src/components/SoulDocumentNav.tsx"
      provides: "Navigation component linking to team member Soul Documents and Meta view"
      exports: ["SoulDocumentNav"]
  key_links:
    - from: "client/src/App.tsx"
      to: "client/src/pages/SoulDocument.tsx"
      via: "React Router route at /soul/:userId"
      pattern: "Route.*soul.*SoulDocument"
    - from: "client/src/App.tsx"
      to: "client/src/pages/MetaSoulDocument.tsx"
      via: "React Router route at /soul/meta/:teamId"
      pattern: "Route.*meta.*MetaSoulDocument"
    - from: "client/src/components/SoulDocumentNav.tsx"
      to: "client/src/hooks/useTeam.ts"
      via: "Team members list for navigation links"
      pattern: "useTeam"
---

<objective>
Wire Soul Document pages into the app's routing and navigation, then verify the complete Phase 3 documentation engine works end-to-end.

Purpose: Without routing and navigation, the Soul Document pages are unreachable. This plan connects everything built in Plans 01-03 into a navigable user experience and verifies the full phase works.

Output: Updated App.tsx with new routes, SoulDocumentNav component for member navigation, and a human verification checkpoint confirming the complete documentation engine.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-documentation-engine/03-01-SUMMARY.md
@.planning/phases/03-documentation-engine/03-02-SUMMARY.md
@.planning/phases/03-documentation-engine/03-03-SUMMARY.md

@client/src/App.tsx
@client/src/hooks/useAuth.tsx
@client/src/hooks/useTeam.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Soul Document routes to App.tsx and create SoulDocumentNav component</name>
  <files>
    client/src/App.tsx
    client/src/components/SoulDocumentNav.tsx
  </files>
  <action>
1. **client/src/components/SoulDocumentNav.tsx** -- Navigation for Soul Document area:
   - Uses `useTeam()` hook to get team members.
   - Uses `useAuth()` to identify current user.
   - Renders a horizontal nav bar (placed at top of Soul Document pages):
     - "My Soul Document" link -> `/soul/{currentUserId}` (highlighted when viewing own document)
     - Link for each other team member -> `/soul/{member.userId}` with member's display name
     - "Meta Soul Document" link -> `/soul/meta/{teamId}` (if teamId available)
   - Style: Subtle secondary navigation bar with inline styles. Horizontal pill-style links. Active link gets the blue highlight (matching App.tsx navLinkActive pattern).
   - Use `useNavigate()` and `useLocation()` from react-router-dom for navigation and active state.
   - Props: none (derives everything from hooks).

2. **client/src/App.tsx** -- Add routes and navigation:
   - Import SoulDocument page: `import SoulDocumentPage from "./pages/SoulDocument.js";`
   - Import MetaSoulDocument page: `import MetaSoulDocumentPage from "./pages/MetaSoulDocument.js";`
   - Add nav link in AppLayout header nav (after "Projects" button):
     ```
     <button onClick={() => navigate("/soul")} style={{ ...styles.navLink, ...(isActive("/soul") ? styles.navLinkActive : {}) }}>
       Soul Docs
     </button>
     ```
   - Add a redirect route: `/soul` -> redirect to `/soul/{currentUserId}` (requires reading user from auth context; use a small SoulRedirect component that reads useAuth and navigates to `/soul/${user.id}`).
   - Add protected routes (inside the Routes, following existing pattern with ProtectedRoute + AppLayout wrapper):
     ```
     /soul/meta/:teamId -> MetaSoulDocumentPage
     /soul/:userId -> SoulDocumentPage
     ```
     IMPORTANT: Register `/soul/meta/:teamId` BEFORE `/soul/:userId` to prevent "meta" being matched as a userId (same pattern as dashboard overview before /:id in projects routes).
   - Both Soul Document pages should include `<SoulDocumentNav />` at the top. Either:
     (a) Add it inside each page component (SoulDocument.tsx and MetaSoulDocument.tsx), or
     (b) Create a wrapper layout. Option (a) is simpler -- add `import { SoulDocumentNav } from "../components/SoulDocumentNav.js"` to both page files and render it at the top.
     Choose option (a): modify SoulDocument.tsx and MetaSoulDocument.tsx to import and render SoulDocumentNav at the top of their return. This means modifying those files too.
  </action>
  <verify>
    1. Run `cd /Users/developer/eluma && npx tsc --build --noEmit` -- must compile cleanly.
    2. Verify App.tsx has routes for /soul/meta/:teamId and /soul/:userId.
    3. Verify SoulDocumentNav.tsx exists and imports useTeam + useAuth.
    4. Verify "Soul Docs" nav button exists in AppLayout header.
  </verify>
  <done>
    - App.tsx has "Soul Docs" in main navigation header
    - /soul redirects to /soul/{currentUserId}
    - /soul/meta/:teamId renders MetaSoulDocumentPage
    - /soul/:userId renders SoulDocumentPage
    - SoulDocumentNav shows links to all team member Soul Documents and Meta view
    - Both Soul Document pages include SoulDocumentNav at the top
    - All routes protected by ProtectedRoute + AppLayout
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 3 Documentation Engine:
    - Soul Document types, event-sourced reducer, and DocumentWriter service (backend)
    - API endpoints at /api/docs/* for CRUD operations
    - Automatic Soul Document entry generation from project/team/memory events
    - GDPR soft-delete with Markdown regeneration
    - Meta Soul Document with per-member activity aggregation
    - Soul Document viewer with react-markdown rendering
    - Manual text entry input on own Soul Document
    - Navigation between team member Soul Documents and Meta view
  </what-built>
  <how-to-verify>
    1. Start the app: `cd /Users/developer/eluma && npm run dev`
    2. Sign in with existing credentials
    3. Click "Soul Docs" in the top navigation bar
    4. Verify your Soul Document page loads (may be empty if no project activity yet)
    5. In the text input area, type "Testing my first Soul Document reflection" and click "Add Entry"
    6. Verify the entry appears in the list with timestamp, "text" source badge, and rendered content
    7. Create or modify a project (create a new project from /projects) -- this should auto-generate a "decision" entry
    8. Return to your Soul Document -- verify a new entry appeared from the project creation
    9. Click "Remove" on the manual entry -- confirm the dialog -- verify it disappears from the list
    10. Click on the other team member's name in the Soul Document nav to view their document
    11. Click "Meta Soul Document" in the nav -- verify it shows team-level statistics
    12. Verify the Meta page shows member cards with entry counts and source type distribution
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues found</resume-signal>
</task>

</tasks>

<verification>
- All 4 plans compile cleanly together: `npx tsc --build --noEmit`
- Server starts without errors: `npm run dev`
- /soul/:userId route loads Soul Document page
- /soul/meta/:teamId route loads Meta Soul Document page
- Manual entries can be added and soft-deleted
- Project events auto-generate Soul Document entries
- Navigation between Soul Documents works
</verification>

<success_criteria>
The complete Documentation Engine is operational: Soul Documents grow automatically from project activity, users can view and manage their documents, the Meta Soul Document aggregates team patterns, and GDPR soft-delete works correctly. All 6 DOCS requirements (DOCS-01 through DOCS-06) are addressed.
</success_criteria>

<output>
After completion, create `.planning/phases/03-documentation-engine/03-04-SUMMARY.md`
</output>
