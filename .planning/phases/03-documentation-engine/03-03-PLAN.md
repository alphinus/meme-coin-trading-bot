---
phase: 03-documentation-engine
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - client/src/hooks/useSoulDocument.ts
  - client/src/hooks/useMetaSoulDocument.ts
  - client/src/components/SoulDocumentViewer.tsx
  - client/src/components/SoulDocumentEntry.tsx
  - client/src/pages/SoulDocument.tsx
  - client/src/pages/MetaSoulDocument.tsx
autonomous: true

must_haves:
  truths:
    - "useSoulDocument hook fetches entries from /api/docs/soul/:userId and provides addEntry + softDelete methods"
    - "SoulDocumentViewer renders Markdown content with react-markdown and remark-gfm"
    - "Soul Document page shows all non-deleted entries with timestamp, source type badge, and rendered content"
    - "Only the document owner sees the soft-delete button on entries"
    - "Meta Soul Document page shows aggregated statistics per team member"
    - "User can manually add a text entry via an input form on their own Soul Document page"
  artifacts:
    - path: "client/src/hooks/useSoulDocument.ts"
      provides: "Hook for fetching and managing a user's Soul Document"
      exports: ["useSoulDocument"]
    - path: "client/src/hooks/useMetaSoulDocument.ts"
      provides: "Hook for fetching Meta Soul Document"
      exports: ["useMetaSoulDocument"]
    - path: "client/src/components/SoulDocumentViewer.tsx"
      provides: "Markdown renderer with entry-level controls"
      exports: ["SoulDocumentViewer"]
    - path: "client/src/pages/SoulDocument.tsx"
      provides: "Full Soul Document page with entries list and manual input"
      exports: ["default"]
    - path: "client/src/pages/MetaSoulDocument.tsx"
      provides: "Team-level Meta Soul Document view"
      exports: ["default"]
  key_links:
    - from: "client/src/hooks/useSoulDocument.ts"
      to: "/api/docs/soul/:userId"
      via: "apiCall GET/POST/DELETE"
      pattern: "apiCall.*api/docs/soul"
    - from: "client/src/hooks/useMetaSoulDocument.ts"
      to: "/api/docs/meta/:teamId"
      via: "apiCall GET"
      pattern: "apiCall.*api/docs/meta"
    - from: "client/src/components/SoulDocumentViewer.tsx"
      to: "react-markdown"
      via: "ReactMarkdown component for rendering entry content"
      pattern: "ReactMarkdown|react-markdown"
---

<objective>
Build the client-side Soul Document experience: install Markdown rendering deps, create React hooks for data fetching, and build the Soul Document viewer page and Meta Soul Document page.

Purpose: Users need to view their Soul Documents, manually add reflections, soft-delete entries, and see the team-level Meta Soul Document. This plan creates the complete frontend for DOCS-01, DOCS-02, DOCS-05, and DOCS-06 requirements.

Output: 2 new hooks, 2 new components, 2 new pages -- all rendering real data from the Plan 01 API endpoints.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-documentation-engine/03-RESEARCH.md
@.planning/phases/03-documentation-engine/03-01-SUMMARY.md

@client/src/api/client.ts
@client/src/hooks/useProject.ts
@client/src/hooks/useAuth.tsx
@client/src/App.tsx
@shared/types/models.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-markdown + remark-gfm and create Soul Document hooks</name>
  <files>
    client/src/hooks/useSoulDocument.ts
    client/src/hooks/useMetaSoulDocument.ts
  </files>
  <action>
1. **Install dependencies:**
   Run `npm install react-markdown remark-gfm -w client` from the eluma root directory.
   These are the only 2 new client dependencies for this phase (per research).

2. **client/src/hooks/useSoulDocument.ts** -- Follow the exact pattern of useProject.ts:
   - `useSoulDocument(userId: string | undefined)` hook returning `{ entries, markdown, loading, error, addEntry, softDelete, refresh }`
   - `entries`: `SoulDocumentEntry[]` state (non-deleted entries)
   - `markdown`: `string` state (raw Markdown content from /api/docs/soul/:userId/markdown)
   - `loading`: boolean
   - `error`: string | null
   - `fetchDocument`: useCallback that calls `Promise.all([apiCall GET /api/docs/soul/${userId}, apiCall GET /api/docs/soul/${userId}/markdown])` and sets entries + markdown state
   - `useEffect` triggers fetchDocument when userId changes
   - `addEntry(content: string)`: calls `apiCall("POST", /api/docs/soul/${userId}/entry, { content })`, then refetches
   - `softDelete(entryId: string)`: calls `apiCall("DELETE", /api/docs/soul/${userId}/${entryId})`, then refetches
   - `refresh`: exposes fetchDocument
   Import SoulDocumentEntry from `"shared/types/models.js"`, apiCall from `"../api/client.js"`.

3. **client/src/hooks/useMetaSoulDocument.ts** -- Simpler hook:
   - `useMetaSoulDocument(teamId: string | undefined)` returning `{ meta, loading, error, refresh }`
   - `meta`: `MetaSoulDocument | null` state
   - `fetchMeta`: useCallback calling `apiCall GET /api/docs/meta/${teamId}`
   - `useEffect` triggers fetchMeta when teamId changes
   - `refresh`: exposes fetchMeta
   Import MetaSoulDocument from `"shared/types/models.js"`.
  </action>
  <verify>
    1. Run `cd /Users/developer/eluma && npx tsc --build --noEmit` -- must compile cleanly.
    2. Verify react-markdown and remark-gfm are in client/package.json dependencies.
    3. Verify both hook files exist and export their hooks.
  </verify>
  <done>
    - react-markdown 10.x and remark-gfm 4.x installed in client workspace
    - useSoulDocument hook provides entries, markdown, addEntry, softDelete, refresh
    - useMetaSoulDocument hook provides meta, refresh
    - Both hooks follow the established pattern from useProject.ts
    - TypeScript compiles cleanly
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SoulDocumentViewer component and Soul Document + Meta Soul Document pages</name>
  <files>
    client/src/components/SoulDocumentViewer.tsx
    client/src/components/SoulDocumentEntry.tsx
    client/src/pages/SoulDocument.tsx
    client/src/pages/MetaSoulDocument.tsx
  </files>
  <action>
1. **client/src/components/SoulDocumentEntry.tsx** -- Single entry component:
   - Props: `{ entry: SoulDocumentEntry; isOwnDocument: boolean; onSoftDelete: (entryId: string) => void }`
   - Renders:
     - Header row with formatted timestamp (using Intl.DateTimeFormat for locale support), source type as a styled badge (small pill with background color based on type -- decision=blue, status_change=green, kpi=purple, text=gray, etc.), and optionally the projectId if present.
     - Content area rendered with `<ReactMarkdown remarkPlugins={[remarkGfm]}>{entry.content}</ReactMarkdown>`.
     - Soft-delete button (only visible if `isOwnDocument` is true): "Remove" text button, styled subtly in red/gray. On click, shows a confirm dialog ("Remove this entry? It will be hidden but preserved in the audit log.") then calls onSoftDelete(entry.entryId).
   - Style: Clean, calm aesthetic matching the existing app. Use inline styles (CSSProperties) matching the pattern in App.tsx and other components. No Tailwind (project doesn't use it).

2. **client/src/components/SoulDocumentViewer.tsx** -- Entry list renderer:
   - Props: `{ entries: SoulDocumentEntry[]; isOwnDocument: boolean; onSoftDelete: (entryId: string) => void }`
   - Filters to non-deleted entries.
   - If no entries, shows empty state: "No entries yet. Soul Documents grow automatically from your project activity."
   - Maps entries to SoulDocumentEntry components.
   - Entries are in reverse chronological order (newest first) for the UI display.

3. **client/src/pages/SoulDocument.tsx** -- Full page:
   - URL parameter: userId from route params (useParams).
   - Uses `useAuth()` to get current user for isOwnDocument check.
   - Uses `useSoulDocument(userId)` hook.
   - Layout:
     - Page title: "Soul Document: {displayName}" (resolve displayName -- can use userId as fallback)
     - Description text: "A persistent record of thinking patterns, decisions, and reflections."
     - If isOwnDocument, show a manual entry input section:
       - A textarea (3-4 rows) with placeholder "Add a reflection, thought, or note..."
       - "Add Entry" button that calls addEntry(content) and clears the textarea.
       - Disabled state while submitting.
     - `<SoulDocumentViewer entries={entries} isOwnDocument={isOwnDocument} onSoftDelete={softDelete} />`
   - Loading state: "Loading Soul Document..."
   - Error state: show error message with retry button.
   - Style: Match existing page patterns (Dashboard.tsx, ProjectDetail.tsx). Inline CSSProperties.

4. **client/src/pages/MetaSoulDocument.tsx** -- Team-level view:
   - URL parameter: teamId from route params.
   - Uses `useMetaSoulDocument(teamId)` hook.
   - Layout:
     - Page title: "Meta Soul Document"
     - Description: "Team-level patterns and activity across all members. AI-powered analysis will be available after Phase 4."
     - For each member in meta.members:
       - Member card showing: displayName, totalEntries count, source type distribution (simple bar or list showing count per source type), last 3 recent entries (abbreviated -- just timestamp + source type + first 100 chars of content).
     - Patterns section: if patterns array is empty (Phase 3), show: "Pattern analysis will be powered by AI in a future update." styled as an informational note.
   - Loading and error states same pattern as SoulDocument page.
   - Style: Cards with subtle borders, matching the existing calm aesthetic.
  </action>
  <verify>
    1. Run `cd /Users/developer/eluma && npx tsc --build --noEmit` -- must compile cleanly.
    2. Verify all 4 files exist at their expected paths.
    3. Check that ReactMarkdown and remarkGfm are imported in SoulDocumentEntry.tsx.
  </verify>
  <done>
    - SoulDocumentEntry renders individual entries with Markdown content, timestamp, source badge, and conditional delete button
    - SoulDocumentViewer lists entries in reverse chronological order with empty state
    - SoulDocument page shows a user's Soul Document with manual entry input (own document only) and soft-delete controls
    - MetaSoulDocument page shows per-member statistics with source type distribution and recent entries
    - All components use inline styles matching existing codebase aesthetic
    - react-markdown renders Soul Document content safely (XSS-safe by default)
  </done>
</task>

</tasks>

<verification>
- `npx tsc --build --noEmit` passes with zero errors
- react-markdown and remark-gfm in client/package.json
- 2 hooks, 2 components, 2 pages all exist and export correctly
- SoulDocumentEntry.tsx uses ReactMarkdown for content rendering
- SoulDocument.tsx uses useSoulDocument hook and shows manual input for own document
- MetaSoulDocument.tsx uses useMetaSoulDocument hook and displays member aggregations
</verification>

<success_criteria>
Complete Soul Document client experience: users can view their Soul Document entries rendered as Markdown, manually add text reflections, soft-delete individual entries (own document only), and view the team-level Meta Soul Document with per-member activity statistics.
</success_criteria>

<output>
After completion, create `.planning/phases/03-documentation-engine/03-03-SUMMARY.md`
</output>
