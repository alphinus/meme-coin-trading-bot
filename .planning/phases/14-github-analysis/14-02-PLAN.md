---
phase: 14-github-analysis
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - client/src/components/GitHubAnalyze.tsx
  - client/src/hooks/useIntegrations.ts
  - client/src/i18n/locales/en.json
  - client/src/i18n/locales/de.json
  - client/src/pages/Integrations.tsx
  - server/src/telegram/handlers/text.ts
  - server/src/telegram/formatters.ts
  - server/src/telegram/locales/en.ftl
  - server/src/telegram/locales/de.ftl
autonomous: false

must_haves:
  truths:
    - "User pastes a GitHub URL in the web UI and sees analysis results (README summary, tech stack, file tree) within seconds"
    - "Analysis results show the AI-generated idea title and a link to the Idea Pool"
    - "User pastes a GitHub URL in Telegram and receives formatted analysis results plus confirmation of idea creation"
    - "All UI text is translated in both English and German via i18n"
  artifacts:
    - path: "client/src/components/GitHubAnalyze.tsx"
      provides: "GitHub URL input with synchronous analysis display"
      exports: ["GitHubAnalyze"]
    - path: "client/src/hooks/useIntegrations.ts"
      provides: "analyzeRepo method for client"
      contains: "analyzeRepo"
    - path: "server/src/telegram/handlers/text.ts"
      provides: "GitHub URL detection in free text messages"
      contains: "github\\.com"
    - path: "server/src/telegram/formatters.ts"
      provides: "formatGitHubAnalysis formatter function"
      exports: ["formatGitHubAnalysis"]
  key_links:
    - from: "client/src/components/GitHubAnalyze.tsx"
      to: "/api/github/analyze"
      via: "useIntegrations().analyzeRepo"
      pattern: "analyzeRepo"
    - from: "client/src/pages/Integrations.tsx"
      to: "client/src/components/GitHubAnalyze.tsx"
      via: "GitHubAnalyze component import and render"
      pattern: "GitHubAnalyze"
    - from: "server/src/telegram/handlers/text.ts"
      to: "server/src/integrations/github/analyzer.ts"
      via: "analyzeRepo import"
      pattern: "import.*analyzeRepo.*analyzer"
---

<objective>
Build the web UI component and Telegram handler for GitHub repository analysis, connecting them to the backend analyzer from Plan 01. Users can paste a GitHub URL in either the web interface or Telegram to trigger read-only analysis and auto-idea creation.

Purpose: Implements GH-01 (web UI), GH-03 (Telegram), completing all user-facing surfaces for GitHub analysis.
Output: GitHubAnalyze component on Integrations page, Telegram URL detection in text handler, i18n translations for both.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-github-analysis/14-RESEARCH.md
@.planning/phases/14-github-analysis/14-01-SUMMARY.md

@client/src/components/GitHubFork.tsx
@client/src/hooks/useIntegrations.ts
@client/src/pages/Integrations.tsx
@client/src/i18n/locales/en.json
@client/src/i18n/locales/de.json
@server/src/telegram/handlers/text.ts
@server/src/telegram/formatters.ts
@server/src/telegram/locales/en.ftl
@server/src/telegram/locales/de.ftl
@server/src/telegram/auth.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GitHubAnalyze component, add analyzeRepo to hook, wire into Integrations page, add i18n</name>
  <files>
    client/src/components/GitHubAnalyze.tsx
    client/src/hooks/useIntegrations.ts
    client/src/pages/Integrations.tsx
    client/src/i18n/locales/en.json
    client/src/i18n/locales/de.json
  </files>
  <action>
1. In `client/src/hooks/useIntegrations.ts`:
   - Import `RepoAnalysis` from `shared/types/integration.js`
   - Add to `UseIntegrationsReturn` interface:
     ```typescript
     /** Analyze a GitHub repo (read-only, no fork) */
     analyzeRepo: (url: string, teamId: string, language?: string) => Promise<RepoAnalysis | null>;
     /** Whether analysis is in progress */
     analyzeLoading: boolean;
     ```
   - Add state: `const [analyzeLoading, setAnalyzeLoading] = useState(false);`
   - Add `analyzeRepo` callback:
     ```typescript
     const analyzeRepo = useCallback(
       async (url: string, teamId: string, language?: string): Promise<RepoAnalysis | null> => {
         setAnalyzeLoading(true);
         setError(null);
         try {
           const result = await apiCall<RepoAnalysis>("POST", "/api/github/analyze", {
             url, teamId, language: language || "en",
           });
           if (result.success) return result.data;
           setError(result.error);
           return null;
         } catch (err) {
           setError(err instanceof Error ? err.message : "Analysis failed");
           return null;
         } finally {
           setAnalyzeLoading(false);
         }
       },
       []
     );
     ```
   - Add `analyzeRepo` and `analyzeLoading` to the return object

2. Create `client/src/components/GitHubAnalyze.tsx`:
   Follow the GitHubFork.tsx pattern closely but with key differences:
   - No fork status machine. States: `"idle" | "analyzing" | "complete" | "error"`
   - Uses `useIntegrations().analyzeRepo` (NOT `forkRepo`)
   - Uses `useTeam()` for teamId, `useLanguage()` for language and `t()`
   - On submit: validate URL with `GITHUB_URL_REGEX = /github\.com\/[\w.-]+\/[\w.-]+/`, call `analyzeRepo(url, team.id, language)`
   - Store the returned `RepoAnalysis` result in state
   - Display results inline when complete:
     a. Repository name bold (`owner/repo`)
     b. AI summary paragraph
     c. Technologies as a horizontal list of badge-styled spans (light background, small text)
     d. Languages as a list showing top 5 by bytes (format: "TypeScript (45KB)")
     e. File tree as a collapsible section (collapsed by default, click to expand, max 20 shown)
     f. Use cases as bullet list
     g. Green success message: "Idea created: {ideaTitle}" with link to /ideas
     h. "Analyze another" reset button
   - Component styling: follow same inline styles pattern as GitHubFork.tsx (const styles object)
   - All user-facing strings via `t("githubAnalyze.key")` -- no hardcoded text

3. In `client/src/pages/Integrations.tsx`:
   - Import `GitHubAnalyze` from `../components/GitHubAnalyze.js`
   - Add the `<GitHubAnalyze />` component in the GitHub section of the page, alongside or replacing the existing `<GitHubFork />` component. Place it as a new card/section labeled with t("integrations.github_analyze_title"). Keep GitHubFork available for users who want the fork-based analysis.

4. In `client/src/i18n/locales/en.json`, add under a new `"githubAnalyze"` key:
   ```json
   "githubAnalyze": {
     "title": "Analyze Repository",
     "placeholder": "https://github.com/owner/repo",
     "analyze_button": "Analyze",
     "url_hint": "Enter a valid GitHub URL (e.g., https://github.com/owner/repo)",
     "error_empty_url": "Please enter a GitHub URL",
     "error_invalid_url": "URL must be a valid GitHub repository (github.com/owner/repo)",
     "error_no_team": "No team found. Please create a team first.",
     "error_unexpected": "An unexpected error occurred",
     "status_analyzing": "Analyzing repository...",
     "status_complete": "Analysis complete",
     "section_summary": "Summary",
     "section_technologies": "Technologies",
     "section_languages": "Languages",
     "section_files": "File Structure",
     "section_use_cases": "Use Cases",
     "idea_created": "Idea created",
     "view_idea_pool": "View in Idea Pool",
     "analyze_another": "Analyze another",
     "show_files": "Show file tree",
     "hide_files": "Hide file tree"
   }
   ```
   Also add to `"integrations"` section: `"github_analyze_title": "GitHub Repository Analysis"`

5. In `client/src/i18n/locales/de.json`, add matching German translations:
   ```json
   "githubAnalyze": {
     "title": "Repository analysieren",
     "placeholder": "https://github.com/owner/repo",
     "analyze_button": "Analysieren",
     "url_hint": "Gib eine gueltige GitHub-URL ein (z.B. https://github.com/owner/repo)",
     "error_empty_url": "Bitte gib eine GitHub-URL ein",
     "error_invalid_url": "URL muss ein gueltiges GitHub-Repository sein (github.com/owner/repo)",
     "error_no_team": "Kein Team gefunden. Bitte erstelle zuerst ein Team.",
     "error_unexpected": "Ein unerwarteter Fehler ist aufgetreten",
     "status_analyzing": "Repository wird analysiert...",
     "status_complete": "Analyse abgeschlossen",
     "section_summary": "Zusammenfassung",
     "section_technologies": "Technologien",
     "section_languages": "Sprachen",
     "section_files": "Dateistruktur",
     "section_use_cases": "Anwendungsfaelle",
     "idea_created": "Idee erstellt",
     "view_idea_pool": "Im Ideenpool ansehen",
     "analyze_another": "Weitere analysieren",
     "show_files": "Dateibaum anzeigen",
     "hide_files": "Dateibaum ausblenden"
   }
   ```
   Also add to `"integrations"` section: `"github_analyze_title": "GitHub Repository-Analyse"`

   MANDATORY: Use proper German Unicode characters (ae->ä, oe->ö, ue->ü, ss->ß where correct). The JSON examples above use ASCII for plan readability -- the ACTUAL German text must use: gültige, Anwendungsfälle, etc.
  </action>
  <verify>
    Run `npx tsc --noEmit` from eluma root -- zero errors. Verify `GitHubAnalyze.tsx` exists and exports `GitHubAnalyze`. Verify `analyzeRepo` method exists in useIntegrations return. Verify both en.json and de.json have `githubAnalyze` section. Verify Integrations.tsx imports and renders GitHubAnalyze.
  </verify>
  <done>
    GitHubAnalyze component renders on the Integrations page. It accepts a GitHub URL, shows a loading state during analysis, and displays inline results (summary, tech stack, languages, files, use cases, idea link) on completion. All strings are i18n'd in both languages.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add GitHub URL detection to Telegram text handler with analysis formatting</name>
  <files>
    server/src/telegram/handlers/text.ts
    server/src/telegram/formatters.ts
    server/src/telegram/locales/en.ftl
    server/src/telegram/locales/de.ftl
  </files>
  <action>
1. In `server/src/telegram/formatters.ts`:
   - Import `RepoAnalysis` from `shared/types/integration.js`
   - Add and export `formatGitHubAnalysis(analysis: RepoAnalysis, t: TranslateFunc): string`:
     - Format as MarkdownV2:
       ```
       *owner/repo*                             (bold repo name)

       {AI summary, truncated to 500 chars}     (escaped)

       *Technologies:*                          (bold label from t())
         - tech1
         - tech2

       *Languages:*                             (bold label from t())
         - TypeScript (45KB)                    (top 5, sorted by bytes desc)
         - JavaScript (12KB)

       *Use Cases:*                             (bold label from t())
         - use case 1
         - use case 2

       Idea created in Idea Pool               (confirmation from t())
       ```
     - All user text through `escapeMd()` function
     - Language bytes formatted as `Math.round(bytes / 1024)` + "KB"
     - Limit: top 5 languages, all technologies, all use cases
     - Translation keys: `github-analysis-tech`, `github-analysis-languages`, `github-analysis-use-cases`, `github-analysis-idea-created`

2. In `server/src/telegram/handlers/text.ts`:
   - Add imports at top:
     ```typescript
     import { resolveElumaUser, getTeamForUser } from "../auth.js";  // getTeamForUser needs to be added
     import { analyzeRepo } from "../../integrations/github/analyzer.js";
     import { formatGitHubAnalysis } from "../formatters.js";
     import { isGitHubConnected } from "../../integrations/github/client.js";
     ```
     NOTE: `resolveElumaUser` is already imported. Add `getTeamForUser` to the existing import from `../auth.js`.
   - Add regex constant: `const GITHUB_URL_REGEX = /https?:\/\/github\.com\/([a-zA-Z0-9._-]+)\/([a-zA-Z0-9._-]+)(?:\/|$|\?|#)?(?![^\s]*(?:\/issues|\/pull|\/blob|\/tree|\/commit))/;`
     This matches only repo-level URLs (github.com/owner/repo), NOT issue/PR/file URLs. The negative lookahead ensures URLs with /issues, /pull, /blob, /tree, /commit paths are ignored and fall through to help text.
   - In `handleTextMessage`, AFTER the pending workflow input check but BEFORE the help message fallback:
     ```typescript
     // GitHub URL detection (before help fallback)
     const text = ctx.message?.text || "";
     const githubMatch = text.match(GITHUB_URL_REGEX);
     if (githubMatch) {
       if (!isGitHubConnected()) {
         await ctx.reply(ctx.t("github-not-connected"));
         return;
       }

       const user = await resolveElumaUser(ctx.from?.id ?? 0);
       if (!user) {
         await ctx.reply(ctx.t("handler-not-linked"));
         return;
       }

       const team = await getTeamForUser(user.id);
       if (!team) {
         await ctx.reply(ctx.t("github-analysis-no-team"));
         return;
       }

       // Send typing indicator and preliminary message
       await ctx.api.sendChatAction(ctx.chat!.id, "typing");
       await ctx.reply(ctx.t("github-analyzing"));

       try {
         const language = (ctx.session.language as "de" | "en") || "en";
         const result = await analyzeRepo(githubMatch[1], githubMatch[2], user.id, team.id, language);
         await ctx.reply(formatGitHubAnalysis(result, ctx.t), { parse_mode: "MarkdownV2" });
       } catch (err) {
         console.error("[telegram/text] GitHub analysis failed:", err);
         await ctx.reply(ctx.t("github-analysis-failed"));
       }
       return;
     }
     ```

3. In `server/src/telegram/locales/en.ftl`, add:
   ```
   github-analyzing = Analyzing repository...
   github-not-connected = GitHub is not connected. Ask the admin to set GITHUB_TOKEN.
   github-analysis-failed = Repository analysis failed. Please check the URL and try again.
   github-analysis-no-team = No team found. Please set up your account first.
   github-analysis-tech = Technologies
   github-analysis-languages = Languages
   github-analysis-use-cases = Use Cases
   github-analysis-idea-created = Idea created in Idea Pool
   ```

4. In `server/src/telegram/locales/de.ftl`, add:
   ```
   github-analyzing = Repository wird analysiert...
   github-not-connected = GitHub ist nicht verbunden. Bitte den Admin bitten, GITHUB_TOKEN zu setzen.
   github-analysis-failed = Repository-Analyse fehlgeschlagen. Bitte überprüfe die URL und versuche es erneut.
   github-analysis-no-team = Kein Team gefunden. Bitte richte zuerst dein Konto ein.
   github-analysis-tech = Technologien
   github-analysis-languages = Sprachen
   github-analysis-use-cases = Anwendungsfälle
   github-analysis-idea-created = Idee im Ideenpool erstellt
   ```

   MANDATORY: Use proper German Unicode characters (ü, ö, ä, ß).
  </action>
  <verify>
    Run `npx tsc --noEmit` from eluma root -- zero errors. Verify `formatGitHubAnalysis` is exported from `formatters.ts`. Verify `text.ts` contains the GITHUB_URL_REGEX and analyzeRepo import. Verify both .ftl files contain the new keys.
  </verify>
  <done>
    Telegram text handler detects GitHub URLs in free text, triggers read-only analysis, and replies with formatted MarkdownV2 results including repo name, AI summary, technologies, languages, use cases, and idea creation confirmation. Non-repo GitHub URLs (issues, PRs, files) are ignored. Both EN and DE Telegram locales have all required strings.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify GitHub analysis end-to-end in web UI</name>
  <what-built>Complete GitHub repository analysis feature: web UI component on Integrations page and Telegram text handler. User pastes a GitHub URL and gets AI-powered analysis with auto-idea creation.</what-built>
  <how-to-verify>
    1. Start the dev server: `npm run dev` from eluma root
    2. Navigate to the Integrations page in the browser
    3. Find the "GitHub Repository Analysis" section
    4. Paste a public GitHub URL (e.g., https://github.com/expressjs/express)
    5. Click "Analyze" and wait 2-5 seconds
    6. Verify the results appear:
       - AI summary paragraph
       - Technology badges
       - Language breakdown
       - Collapsible file tree
       - Use cases
       - "Idea created" with link to Idea Pool
    7. Click the Idea Pool link -- verify the new idea exists with the AI-generated title
    8. Switch language to German and verify all labels are translated
    9. (Optional) If Telegram bot is running, send a GitHub URL to the bot and verify formatted reply
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. Web UI: Integrations page shows GitHubAnalyze component with URL input and Analyze button
3. Web UI: Analyzing a repo shows inline results (summary, tech, languages, files, use cases, idea link)
4. Web UI: All strings are i18n'd -- switching language changes all labels
5. Telegram: Sending a GitHub URL in chat triggers analysis and formatted reply
6. Telegram: Non-repo URLs (issues, PRs, etc.) are NOT intercepted
7. Telegram: Both EN and DE locale files have all github-analysis-* keys
8. Auto-created ideas appear in the Idea Pool with correct title and "refining" status
</verification>

<success_criteria>
Users can paste a GitHub URL in both the web UI (Integrations page) and Telegram to get instant AI-powered analysis including README summary, tech stack, languages, file structure, and use cases. An idea is auto-created in the pool and visible via the provided link. All text is properly internationalized.
</success_criteria>

<output>
After completion, create `.planning/phases/14-github-analysis/14-02-SUMMARY.md`
</output>
