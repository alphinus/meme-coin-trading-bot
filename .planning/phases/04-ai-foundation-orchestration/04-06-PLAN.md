---
phase: 04-ai-foundation-orchestration
plan: 06
type: execute
wave: 3
depends_on: ["04-05"]
files_modified:
  - client/src/App.tsx
  - client/src/pages/Dashboard.tsx
  - shared/types/models.ts
autonomous: false

must_haves:
  truths:
    - "AI Dashboard page is accessible via navigation"
    - "AI face emoji indicator is visible on the main dashboard"
    - "TeamMember model supports role 'ai' for the AI member"
    - "Application builds and runs without errors"
  artifacts:
    - path: "client/src/App.tsx"
      provides: "AI Dashboard route at /ai"
      contains: "AiDashboard"
    - path: "client/src/pages/Dashboard.tsx"
      provides: "AI team member widget embedded in main dashboard"
      contains: "AiTeamMember"
    - path: "shared/types/models.ts"
      provides: "TeamMember role includes 'ai'"
      contains: "ai"
  key_links:
    - from: "client/src/App.tsx"
      to: "client/src/pages/AiDashboard.tsx"
      via: "React Router Route at /ai"
      pattern: "path.*ai.*AiDashboard"
    - from: "client/src/pages/Dashboard.tsx"
      to: "client/src/components/AiTeamMember.tsx"
      via: "Component import and render"
      pattern: "AiTeamMember"
---

<objective>
Wire the AI Dashboard into the app routing and navigation, embed the AI team member indicator on the main dashboard, update the TeamMember model, and run end-to-end verification.

Purpose: This is the final integration step that makes all Phase 4 features accessible to users. The AI dashboard gets a route and nav link, the face emoji appears on the main dashboard, and the TeamMember model officially supports AI members. The checkpoint verifies everything works together.

Output: Routes wired, dashboard updated, model updated, full application verified
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-ai-foundation-orchestration/04-RESEARCH.md

# Files to modify
@eluma/client/src/App.tsx
@eluma/client/src/pages/Dashboard.tsx
@eluma/shared/types/models.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire AI routes, navigation, dashboard widget, and TeamMember model</name>
  <files>
    client/src/App.tsx
    client/src/pages/Dashboard.tsx
    shared/types/models.ts
  </files>
  <action>
1. Update `shared/types/models.ts`:
   - Change TeamMember.role from `"owner" | "member"` to `"owner" | "member" | "ai"`
   - This allows the AI to appear naturally in team member lists

2. Update `client/src/App.tsx`:
   - Add import: `import AiDashboardPage from "./pages/AiDashboard.js";`
   - Add a protected route for the AI Dashboard:
     ```
     <Route path="/ai" element={<ProtectedRoute><AppLayout><AiDashboardPage /></AppLayout></ProtectedRoute>} />
     ```
   - Add "AI" nav link in the AppLayout nav bar (between "Soul Docs" and the header right section):
     ```
     <button type="button" onClick={() => navigate("/ai")} style={{ ...styles.navLink, ...(isActive("/ai") ? styles.navLinkActive : {}) }}>AI</button>
     ```

3. Update `client/src/pages/Dashboard.tsx`:
   - Import AiTeamMember from "../components/AiTeamMember.js"
   - Import useTeam (or however team context is accessed -- check existing Dashboard.tsx for pattern)
   - Add the AiTeamMember component to the dashboard layout, positioned as a small card widget
   - Place it near the top-right area or in a sidebar section depending on existing layout
   - Only render if the user has a teamId (conditionally render: `{teamId && <AiTeamMember teamId={teamId} />}`)
   - The face emoji indicator from AiTeamMember will show when AI has something to say

4. Verify the full build compiles:
   ```
   cd /Users/developer/eluma && npx tsc --build --noEmit
   ```
  </action>
  <verify>
    Run `cd /Users/developer/eluma && npx tsc --build --noEmit` -- TypeScript compiles with no errors. Verify App.tsx has /ai route and AI nav link. Verify Dashboard.tsx renders AiTeamMember. Verify TeamMember role union includes "ai". Start the dev server briefly to confirm no runtime errors: `cd /Users/developer/eluma && timeout 10 npm run dev 2>&1 || true` (expect it to start or show only expected warnings).
  </verify>
  <done>
    AI Dashboard accessible at /ai with nav link. AI team member widget visible on main dashboard with face emoji. TeamMember model supports "ai" role. Full application compiles and starts.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 4 AI Foundation & Orchestration:
    - Multi-provider AI (Anthropic + OpenAI) via Vercel AI SDK with task-type routing
    - AI trigger engine evaluating domain events against 5 rules
    - AI reflections writing to Soul Documents when milestones are reached
    - Face emoji notification system (AI has something to say)
    - Cost tracking per AI call with dashboard showing per-project/model/month costs
    - Model override per task type
    - Decision override with mandatory reason (slide-on menu)
    - Conflict mediation (analyzes two positions, proposes compromise)
    - Text-to-speech for AI responses (German/English)
    - AI dashboard page and main dashboard widget
  </what-built>
  <how-to-verify>
    1. Start the dev server: `cd /Users/developer/eluma && npm run dev`
    2. Log in and navigate to the main dashboard at /home
    3. Verify the AI team member widget is visible (should show default "AI" name with idle state)
    4. Click "AI" in the navigation bar to go to /ai
    5. Verify the AI Dashboard page loads with:
       - AI team member configuration card (name, character, language)
       - Cost dashboard widget (may show "No AI costs recorded yet")
       - Model override table showing task types and model assignments
    6. Try configuring the AI member: change name to "Eluma AI", set character description, select language
    7. If API keys are configured (ANTHROPIC_API_KEY / OPENAI_API_KEY in .env):
       - Create a new project or complete a phase to trigger AI reflection
       - Check Soul Document for AI reflection entry
       - Try the TTS button on any AI response text
    8. Verify the override slide-on menu works: it should require a reason before submitting
    9. Check that navigation between Dashboard, Projects, Soul Docs, and AI works smoothly
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- Full application builds: `npx tsc --build --noEmit` passes
- Dev server starts without errors
- /ai route accessible and renders AI Dashboard
- AI nav link visible in header
- AI team member widget on main dashboard
- TeamMember role type includes "ai"
- All Phase 4 requirements addressed:
  - AI-01: Configurable AI team member (name, character) -- CHECK
  - AI-02: Face emoji on dashboard -- CHECK
  - AI-03: Text-to-speech -- CHECK
  - AI-04/I18N-02: Language selection (DE/EN) -- CHECK
  - AI-05: Trigger-based only -- CHECK
  - AI-06: Multi-provider (Anthropic + OpenAI) -- CHECK
  - AI-07: Temperature presets per task type -- CHECK
  - AI-08: Model override per task type -- CHECK
  - AI-09: Cost dashboard -- CHECK
  - AI-10: Decision override with audit -- CHECK
  - AI-11: Conflict mediation -- CHECK
</verification>

<success_criteria>
- Application compiles and starts
- AI Dashboard accessible via /ai route with navigation link
- AI team member indicator visible on main dashboard
- All 12 Phase 4 requirements (AI-01 through AI-11 plus I18N-02) have corresponding implementations
- User can configure AI member, view costs, override models, and trigger mediation
</success_criteria>

<output>
After completion, create `.planning/phases/04-ai-foundation-orchestration/04-06-SUMMARY.md`
</output>
