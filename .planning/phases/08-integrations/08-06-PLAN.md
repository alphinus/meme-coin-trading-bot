---
phase: 08-integrations
plan: 06
type: execute
wave: 3
depends_on: ["08-02", "08-04"]
files_modified:
  - client/src/hooks/useIntegrations.ts
  - client/src/components/EmailDraftReview.tsx
  - client/src/components/CalendarWidget.tsx
autonomous: true

must_haves:
  truths:
    - "User can see integration connection status for Google"
    - "User can view received emails, see AI routing suggestions, and review/approve/send email drafts"
    - "User can see calendar meetings linked to projects"
  artifacts:
    - path: "client/src/hooks/useIntegrations.ts"
      provides: "React hook for integration status, Gmail management, Calendar management"
      exports: ["useIntegrations"]
    - path: "client/src/components/EmailDraftReview.tsx"
      provides: "Email draft card with approve/reject actions"
    - path: "client/src/components/CalendarWidget.tsx"
      provides: "Calendar meetings list with project linking"
  key_links:
    - from: "client/src/hooks/useIntegrations.ts"
      to: "/api/integrations"
      via: "fetch calls to integration REST API"
      pattern: "fetch.*api/integrations"
    - from: "client/src/hooks/useIntegrations.ts"
      to: "/api/calendar"
      via: "fetch calls to calendar REST API"
      pattern: "fetch.*api/calendar"
---

<objective>
Create client hooks and components for Gmail/Calendar integration UI -- the email and calendar portion of the client layer.

Purpose: Users can manage Gmail emails (view, route, draft, send) and Calendar meetings (view, link to projects) through the web UI.
Output: useIntegrations hook (Gmail + Calendar portions), EmailDraftReview component, CalendarWidget component.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-integrations/08-02-SUMMARY.md
@.planning/phases/08-integrations/08-04-SUMMARY.md
@client/src/hooks/useProjects.ts
@client/src/hooks/useIdeaPool.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: useIntegrations hook (Gmail + Calendar + status)</name>
  <files>
    client/src/hooks/useIntegrations.ts
  </files>
  <action>
Create `client/src/hooks/useIntegrations.ts`:
   - Follow the pattern of existing hooks (useProjects.ts, useIdeaPool.ts)
   - State: integrationStatus, emails, drafts, calendarMeetings, loading, error
   - `fetchStatus()`: GET /api/integrations/status
   - `connectGoogle()`: GET /api/integrations/google/auth-url, then window.location.href = authUrl (redirect to Google OAuth)
   - `disconnectGoogle()`: POST /api/integrations/google/disconnect
   - `startGmailPolling()`: POST /api/integrations/gmail/start-polling
   - `stopGmailPolling()`: POST /api/integrations/gmail/stop-polling
   - `fetchEmails()`: GET /api/integrations/emails/recent
   - `routeEmail(messageId)`: GET /api/integrations/emails/:messageId/route -> returns suggestions
   - `confirmRoute(messageId, projectId)`: POST /api/integrations/emails/:messageId/route { projectId }
   - `fetchDrafts()`: GET /api/integrations/emails/drafts
   - `generateDraft(messageId, projectId)`: POST /api/integrations/emails/drafts/generate { messageId, projectId }
   - `sendDraft(draftId)`: POST /api/integrations/emails/drafts/:draftId/send
   - `rejectDraft(draftId)`: POST /api/integrations/emails/drafts/:draftId/reject
   - `fetchMeetings(projectId?)`: GET /api/calendar/meetings?projectId=...
   - `startCalendarPolling()`: POST /api/calendar/start-polling
   - `stopCalendarPolling()`: POST /api/calendar/stop-polling
   - `linkMeeting(eventId, projectId)`: POST /api/calendar/meetings/:eventId/link { projectId }
   - `unlinkMeeting(eventId)`: POST /api/calendar/meetings/:eventId/unlink
   - Use apiGet/apiPost helpers from existing api utility if available, or use fetch with credentials: "include"
   - Also export GitHub-related stubs (fetchLinkedRepos, fetchCommits, fetchPullRequests, forkRepo, linkRepo) that call /api/github-integration endpoints -- these will be used by Plan 08-07.
  </action>
  <verify>
    Run `cd /Users/developer/eluma && npx tsc --noEmit` -- zero errors.
    Verify useIntegrations.ts exports useIntegrations hook.
    Grep for "fetchEmails" in useIntegrations.ts.
    Grep for "fetchMeetings" in useIntegrations.ts.
  </verify>
  <done>
    useIntegrations hook provides complete API for Gmail operations (polling, emails, routing, drafts), Calendar operations (polling, meetings, linking), integration status, and GitHub operation stubs. All TypeScript compiles.
  </done>
</task>

<task type="auto">
  <name>Task 2: EmailDraftReview and CalendarWidget components</name>
  <files>
    client/src/components/EmailDraftReview.tsx
    client/src/components/CalendarWidget.tsx
  </files>
  <action>
1. Create `client/src/components/EmailDraftReview.tsx`:
   - Props: draft (EmailDraft), onSend (draftId) => void, onReject (draftId) => void
   - Display: To, Subject, Body (in a styled email preview card)
   - Actions: "Approve & Send" button (green), "Reject" button (red)
   - On approve: calls onSend(draft.id)
   - On reject: calls onReject(draft.id)
   - Status badge: pending (yellow), sent (green), rejected (gray)
   - Tailwind styling: rounded card, border, p-4, flex buttons

2. Create `client/src/components/CalendarWidget.tsx`:
   - Props: projectId (optional), meetings (CalendarMeeting[]), onLink (eventId, projectId) => void
   - Displays meetings as a vertical list: title, date/time, attendees count, linked project badge
   - Upcoming meetings highlighted (start > now)
   - "Link to project" button for unlinked meetings (opens simple project selector dropdown)
   - Compact design suitable for embedding in ProjectDetail page sidebar
   - Tailwind styling: compact cards, divide-y list, text-sm for details
  </action>
  <verify>
    Run `cd /Users/developer/eluma && npx tsc --noEmit` -- zero errors.
    Verify EmailDraftReview.tsx exists and is importable.
    Verify CalendarWidget.tsx exists and is importable.
  </verify>
  <done>
    EmailDraftReview displays email drafts with approve/reject actions and status badges. CalendarWidget shows meetings with project linking. Both components use Tailwind styling and are ready for integration into the Integrations page.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- useIntegrations hook exports all Gmail, Calendar, and status functions
- EmailDraftReview renders draft with approve/send/reject actions
- CalendarWidget renders meetings with project linking
</verification>

<success_criteria>
Gmail and Calendar client layer complete. Hook provides all API functions. EmailDraftReview and CalendarWidget components ready for Integrations page assembly.
</success_criteria>

<output>
After completion, create `.planning/phases/08-integrations/08-06-SUMMARY.md`
</output>
