---
phase: 06-voice-idea-pool
plan: 04
type: execute
wave: 4
depends_on: ["06-01", "06-02", "06-03"]
files_modified:
  - server/src/app.ts
  - client/src/App.tsx
  - client/src/i18n/locales/en.json
  - client/src/i18n/locales/de.json
autonomous: false

must_haves:
  truths:
    - "Voice and ideas routes are registered in Express app and reachable via /api/voice/* and /api/ideas/*"
    - "IdeaPool page is accessible at /ideas route in the browser"
    - "Idea Pool nav link appears in the app header"
    - "All Idea Pool UI text is translatable in German and English"
    - "Full flow works: record audio -> transcribe -> route or create idea -> refine -> graduate"
  artifacts:
    - path: "server/src/app.ts"
      provides: "Voice and ideas route registration"
      contains: "voiceRouter"
    - path: "client/src/App.tsx"
      provides: "/ideas route and Idea Pool nav link"
      contains: "IdeaPool"
    - path: "client/src/i18n/locales/en.json"
      provides: "English translations for Idea Pool"
      contains: "ideaPool"
    - path: "client/src/i18n/locales/de.json"
      provides: "German translations for Idea Pool"
      contains: "ideaPool"
  key_links:
    - from: "server/src/app.ts"
      to: "server/src/routes/voice.ts"
      via: "app.use('/api/voice', requireAuth, voiceRouter)"
      pattern: "api/voice.*voiceRouter"
    - from: "server/src/app.ts"
      to: "server/src/routes/ideas.ts"
      via: "app.use('/api/ideas', requireAuth, ideasRouter)"
      pattern: "api/ideas.*ideasRouter"
    - from: "client/src/App.tsx"
      to: "client/src/pages/IdeaPool.tsx"
      via: "Route path='/ideas'"
      pattern: "path.*ideas.*IdeaPool"
---

<objective>
Wire all Phase 6 components into the application: register server routes, add client routing and navigation, add i18n translations, and verify the complete end-to-end flow.

Purpose: Makes the Voice & Idea Pool feature discoverable and accessible through the app's navigation. Without this plan, the voice/idea code exists but is unreachable.

Output: Fully integrated Idea Pool feature accessible from the app header, with DE/EN translations and working end-to-end.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-voice-idea-pool/06-RESEARCH.md
@.planning/phases/06-voice-idea-pool/06-01-SUMMARY.md
@.planning/phases/06-voice-idea-pool/06-02-SUMMARY.md
@.planning/phases/06-voice-idea-pool/06-03-SUMMARY.md

# Files to modify
@server/src/app.ts
@client/src/App.tsx
@client/src/i18n/locales/en.json
@client/src/i18n/locales/de.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Register server routes and add client routing, navigation, and i18n</name>
  <files>
    server/src/app.ts
    client/src/App.tsx
    client/src/i18n/locales/en.json
    client/src/i18n/locales/de.json
  </files>
  <action>
    **Update `server/src/app.ts`:**

    1. Import the two new routers at the top:
       ```typescript
       import voiceRouter from './routes/voice.js';
       import ideasRouter from './routes/ideas.js';
       ```
    2. Register them in the protected routes section (after the workflow router):
       ```typescript
       app.use('/api/voice', requireAuth, voiceRouter);
       app.use('/api/ideas', requireAuth, ideasRouter);
       ```

    **Update `client/src/App.tsx`:**

    1. Import the IdeaPool page:
       ```typescript
       import IdeaPool from './pages/IdeaPool.js';
       ```
    2. Add an "Idea Pool" nav button in the AppLayout nav section, between "Projects" and "Soul Docs":
       ```tsx
       <button
         type="button"
         onClick={() => navigate('/ideas')}
         style={{
           ...styles.navLink,
           ...(isActive('/ideas') ? styles.navLinkActive : {}),
         }}
       >
         Idea Pool
       </button>
       ```
       (This should use `t('nav.ideaPool')` from i18n for the button label, following the pattern of other nav buttons. Check if existing nav buttons use `t()` -- if not, use plain text to match.)
    3. Add the route inside the Routes block (after the AI Dashboard route, before Soul Document routes):
       ```tsx
       <Route
         path="/ideas"
         element={
           <ProtectedRoute>
             <AppLayout>
               <IdeaPool />
             </AppLayout>
           </ProtectedRoute>
         }
       />
       ```

    **Update `client/src/i18n/locales/en.json`:**

    Add a new top-level `ideaPool` section:
    ```json
    "ideaPool": {
      "title": "Idea Pool",
      "subtitle": "Capture, refine, and graduate ideas into projects",
      "empty": "No ideas yet. Record a voice memo or type your idea to get started.",
      "create_text": "Or type your idea...",
      "create_submit": "Submit Idea",
      "record": "Record",
      "stop": "Stop",
      "transcribe": "Transcribe",
      "processing": "Processing...",
      "recording": "Recording...",
      "mic_error": "Microphone not available. Please allow microphone access.",
      "mic_denied": "Microphone access denied. Please allow access in your browser settings.",
      "transcription_failed": "Transcription failed. Please try again.",
      "routing_title": "Where does this belong?",
      "routing_project": "Route to {{project}}",
      "routing_idea_pool": "Add to Idea Pool",
      "routing_confidence": "{{confidence}}% confidence",
      "status_capturing": "Capturing",
      "status_refining": "Refining",
      "status_ready": "Ready",
      "status_voting": "Voting",
      "status_graduated": "Graduated",
      "status_archived": "Archived",
      "readiness": "Readiness: {{score}}/100",
      "rounds": "{{current}}/{{max}} rounds",
      "ask_ai": "Ask AI",
      "submit_answer": "Submit Answer",
      "answer_placeholder": "Type your answer...",
      "mark_ready": "Mark as Ready",
      "ready_for_graduation": "Ready for graduation!",
      "max_rounds_reached": "Maximum refinement rounds reached. You can mark this idea as ready or continue editing.",
      "missing_items": "Missing for readiness:",
      "recommendation": "AI recommendation:",
      "propose_graduation": "Propose Graduation",
      "vote_approve": "Approve",
      "vote_reject": "Reject",
      "vote_pending": "Pending",
      "vote_approved": "Approved",
      "vote_rejected": "Rejected",
      "graduated_message": "This idea has graduated to a project!",
      "view_project": "View Project",
      "archive": "Archive Idea",
      "no_voice_support": "Your browser does not support voice recording. Please use the text input instead."
    }
    ```

    Also add to the `nav` section:
    ```json
    "ideaPool": "Idea Pool"
    ```

    **Update `client/src/i18n/locales/de.json`:**

    Add the same `ideaPool` section with German translations:
    ```json
    "ideaPool": {
      "title": "Ideenpool",
      "subtitle": "Ideen erfassen, verfeinern und zu Projekten machen",
      "empty": "Noch keine Ideen. Nehmen Sie eine Sprachnachricht auf oder tippen Sie Ihre Idee ein.",
      "create_text": "Oder Idee eingeben...",
      "create_submit": "Idee einreichen",
      "record": "Aufnehmen",
      "stop": "Stopp",
      "transcribe": "Transkribieren",
      "processing": "Verarbeitung...",
      "recording": "Aufnahme...",
      "mic_error": "Mikrofon nicht verfuegbar. Bitte erlauben Sie den Zugriff.",
      "mic_denied": "Mikrofonzugriff verweigert. Bitte erlauben Sie den Zugriff in Ihren Browsereinstellungen.",
      "transcription_failed": "Transkription fehlgeschlagen. Bitte versuchen Sie es erneut.",
      "routing_title": "Wohin gehoert das?",
      "routing_project": "Weiterleiten an {{project}}",
      "routing_idea_pool": "Zum Ideenpool hinzufuegen",
      "routing_confidence": "{{confidence}}% Konfidenz",
      "status_capturing": "Erfassung",
      "status_refining": "Verfeinerung",
      "status_ready": "Bereit",
      "status_voting": "Abstimmung",
      "status_graduated": "Graduiert",
      "status_archived": "Archiviert",
      "readiness": "Bereitschaft: {{score}}/100",
      "rounds": "{{current}}/{{max}} Runden",
      "ask_ai": "KI fragen",
      "submit_answer": "Antwort senden",
      "answer_placeholder": "Ihre Antwort eingeben...",
      "mark_ready": "Als bereit markieren",
      "ready_for_graduation": "Bereit zur Graduierung!",
      "max_rounds_reached": "Maximale Verfeinerungsrunden erreicht. Sie koennen die Idee als bereit markieren oder weiter bearbeiten.",
      "missing_items": "Fehlend fuer Bereitschaft:",
      "recommendation": "KI-Empfehlung:",
      "propose_graduation": "Graduierung vorschlagen",
      "vote_approve": "Zustimmen",
      "vote_reject": "Ablehnen",
      "vote_pending": "Ausstehend",
      "vote_approved": "Zugestimmt",
      "vote_rejected": "Abgelehnt",
      "graduated_message": "Diese Idee wurde zu einem Projekt graduiert!",
      "view_project": "Projekt ansehen",
      "archive": "Idee archivieren",
      "no_voice_support": "Ihr Browser unterstuetzt keine Sprachaufnahme. Bitte nutzen Sie die Texteingabe."
    }
    ```

    Also add to the `nav` section:
    ```json
    "ideaPool": "Ideenpool"
    ```

    **NOTE on existing nav pattern:** Check whether current nav buttons in App.tsx use `t()` for labels. If they use hardcoded strings (e.g., "Dashboard", "Projects"), match that pattern and use hardcoded "Idea Pool" / "Ideenpool". If they use `t('nav.dashboard')`, use `t('nav.ideaPool')`. Consistency matters more than correctness here.
  </action>
  <verify>
    Run `npx tsc --noEmit`. Verify route registration:
    ```bash
    grep "voiceRouter\|ideasRouter" server/src/app.ts
    grep "IdeaPool\|ideas" client/src/App.tsx
    ```
    Verify i18n keys:
    ```bash
    grep "ideaPool" client/src/i18n/locales/en.json
    grep "ideaPool" client/src/i18n/locales/de.json
    ```
  </verify>
  <done>
    Voice and ideas routes registered in Express at /api/voice and /api/ideas. IdeaPool page accessible at /ideas. Idea Pool nav link in header. All UI strings in both DE and EN.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: End-to-end verification of Voice & Idea Pool</name>
  <what-built>
    Complete Voice & Idea Pool feature:
    1. In-app audio recording via MediaRecorder API
    2. Server-side transcription via AI SDK whisper-1
    3. AI-powered voice routing to projects or Idea Pool
    4. Event-sourced Idea Pool with CRUD operations
    5. AI refinement loop with readiness scoring (0-100)
    6. Team graduation voting with unanimous approval
    7. Idea-to-project promotion
    8. Full i18n (DE/EN)
  </what-built>
  <how-to-verify>
    Start the dev server: `cd /Users/developer/eluma && npm run dev`

    **Test 1: Voice Recording (VOIC-01)**
    1. Navigate to http://localhost:3000/ideas
    2. See the Idea Pool page with VoiceRecorder at top
    3. Click the Record button
    4. Allow microphone access when prompted
    5. Speak for a few seconds
    6. Click Stop
    7. Click Transcribe
    8. EXPECTED: Transcription text appears (requires valid OPENAI_API_KEY)

    **Test 2: Text Input Fallback**
    1. On the /ideas page, use the text input area
    2. Type "Build a customer portal for Swiss SMEs"
    3. Click Submit
    4. EXPECTED: Routing suggestions appear (or idea created directly)

    **Test 3: Idea Creation (VOIC-03)**
    1. After transcription or text input, select "Add to Idea Pool"
    2. EXPECTED: New idea appears in the idea list with status "Refining"

    **Test 4: AI Refinement (VOIC-04)**
    1. Click on the newly created idea
    2. Click "Ask AI" button
    3. EXPECTED: AI generates a refinement question
    4. Type an answer and click Submit
    5. EXPECTED: Readiness score updates, missing items shown
    6. Repeat 2-3 rounds
    7. EXPECTED: Score increases with each round

    **Test 5: Manual Override**
    1. Click "Mark as Ready" on an idea in refining status
    2. EXPECTED: Status changes to "Ready"

    **Test 6: Graduation Voting (VOIC-05)**
    1. On a "Ready" idea, click "Propose Graduation"
    2. EXPECTED: Status changes to "Voting"
    3. Click "Approve" as the current user
    4. EXPECTED: Vote registered. If 2-person team and both voted, idea graduates to a new project
    5. EXPECTED: Link to new project appears

    **Test 7: Navigation**
    1. Verify "Idea Pool" link in app header
    2. Click it from any page
    3. EXPECTED: Navigates to /ideas

    **Test 8: i18n**
    1. Switch language to German
    2. EXPECTED: All Idea Pool text appears in German
  </how-to-verify>
  <resume-signal>Type "approved" to confirm Phase 6 is complete, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. Server starts without errors with voice and ideas routes registered
2. /ideas page loads and shows VoiceRecorder
3. Audio recording produces a blob and transcription returns text
4. Ideas appear in the list with correct status and readiness
5. Refinement loop generates questions and updates scores
6. Graduation flow creates a real project
7. All UI text translatable in DE and EN
8. No TypeScript compilation errors
</verification>

<success_criteria>
All 5 phase requirements (VOIC-01 through VOIC-05) are verifiably met:
- VOIC-01: Audio recording works in browser, AI transcribes accurately
- VOIC-02: AI routes transcription to correct project or Idea Pool
- VOIC-03: Idea Pool is a visible staging area with voice-first input
- VOIC-04: AI deep-questions until readiness threshold met
- VOIC-05: Team members vote to graduate ideas into projects
</success_criteria>

<output>
After completion, create `.planning/phases/06-voice-idea-pool/06-04-SUMMARY.md`
</output>
