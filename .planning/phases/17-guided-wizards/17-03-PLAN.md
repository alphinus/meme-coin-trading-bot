---
phase: 17-guided-wizards
plan: 03
type: execute
wave: 2
depends_on: ["17-01"]
files_modified:
  - client/src/components/wizards/IdeaToProjectWizard/IdeaToProjectWizard.tsx
  - client/src/components/wizards/IdeaToProjectWizard/StepQuestion.tsx
  - client/src/components/wizards/IdeaToProjectWizard/StepProjectReady.tsx
  - client/src/components/QualityGateIndicator.tsx
  - client/src/hooks/useQualityGate.ts
  - client/src/components/IdeaGraduation.tsx
  - client/src/i18n/locales/en.json
  - client/src/i18n/locales/de.json
autonomous: true

must_haves:
  truths:
    - "User sees GSD questions one per screen with progress indicator when converting idea to project"
    - "Each question screen has title, description (Expert mode), input field, and navigation buttons"
    - "Progress indicator shows which questions are answered and which remain"
    - "User cannot complete the wizard and create a project until all mandatory questions are answered"
    - "Quality gate blocks graduation with clear explanation of what is missing"
    - "Wizard works identically in Simple and Expert mode -- no bypass possible"
    - "All wizard text renders correctly in both DE and EN"
  artifacts:
    - path: "client/src/components/wizards/IdeaToProjectWizard/IdeaToProjectWizard.tsx"
      provides: "GSD questioning wizard using WizardShell with one question per step"
      min_lines: 40
    - path: "client/src/components/wizards/IdeaToProjectWizard/StepQuestion.tsx"
      provides: "Single GSD question screen with input, progress bar, and navigation"
      min_lines: 50
    - path: "client/src/components/wizards/IdeaToProjectWizard/StepProjectReady.tsx"
      provides: "Final step showing all answers and create project button"
      min_lines: 30
    - path: "client/src/components/QualityGateIndicator.tsx"
      provides: "Progress indicator showing answered vs remaining questions (GATE-04)"
      min_lines: 20
    - path: "client/src/hooks/useQualityGate.ts"
      provides: "Hook for fetching quality gate status from server"
    - path: "client/src/components/IdeaGraduation.tsx"
      provides: "Updated graduation flow routing through wizard before project creation"
  key_links:
    - from: "client/src/components/wizards/IdeaToProjectWizard/IdeaToProjectWizard.tsx"
      to: "client/src/components/wizards/WizardShell.tsx"
      via: "import WizardShell"
      pattern: "WizardShell"
    - from: "client/src/components/wizards/IdeaToProjectWizard/StepQuestion.tsx"
      to: "shared/types/wizard.ts"
      via: "import GsdMandatoryQuestion type"
      pattern: "GsdMandatoryQuestion|MandatoryQuestion"
    - from: "client/src/components/IdeaGraduation.tsx"
      to: "client/src/components/wizards/IdeaToProjectWizard/IdeaToProjectWizard.tsx"
      via: "render wizard before graduation"
      pattern: "IdeaToProjectWizard"
    - from: "client/src/components/QualityGateIndicator.tsx"
      to: "client/src/hooks/useQualityGate.ts"
      via: "useQualityGate hook"
      pattern: "useQualityGate"
---

<objective>
Build the idea-to-project wizard (WIZ-03, WIZ-04) with one GSD question per screen, progress tracking, and quality gate UI enforcement. Integrate the wizard into the existing graduation flow so users must answer all mandatory questions before a project can be created.

Purpose: This is the core wizard of Phase 17 -- it enforces the quality gate by guiding users through mandatory GSD questions before project creation is allowed. The progress indicator (GATE-04) and blocking behavior (GATE-01, GATE-02) ensure no project is created without proper definition, regardless of mode (GATE-03).

Output: IdeaToProjectWizard with question-per-screen flow, QualityGateIndicator component, useQualityGate hook, updated IdeaGraduation to route through wizard, i18n keys in DE and EN.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-guided-wizards/17-RESEARCH.md
@.planning/phases/17-guided-wizards/17-01-SUMMARY.md

# Existing components to modify/reference
@client/src/components/IdeaGraduation.tsx
@client/src/components/wizards/WizardShell.tsx
@client/src/components/workflow/StepProgress.tsx
@client/src/hooks/useIdeaPool.ts
@client/src/hooks/useMode.ts
@server/src/workflow/gsd-questions.ts
@server/src/middleware/quality-gate.ts
@shared/types/wizard.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build IdeaToProjectWizard with question-per-screen flow and progress indicator</name>
  <files>
    client/src/components/wizards/IdeaToProjectWizard/IdeaToProjectWizard.tsx
    client/src/components/wizards/IdeaToProjectWizard/StepQuestion.tsx
    client/src/components/wizards/IdeaToProjectWizard/StepProjectReady.tsx
    client/src/components/QualityGateIndicator.tsx
    client/src/hooks/useQualityGate.ts
    client/src/i18n/locales/en.json
    client/src/i18n/locales/de.json
  </files>
  <action>
    **1. Create client/src/hooks/useQualityGate.ts:**

    A hook that fetches the mandatory GSD questions list from the server and tracks answers locally:

    ```typescript
    interface UseQualityGateReturn {
      questions: MandatoryQuestion[];
      answers: Record<string, string>;
      setAnswer: (questionId: string, value: string) => void;
      answeredCount: number;
      totalRequired: number;
      allAnswered: boolean;
      loading: boolean;
    }
    ```

    - Fetch questions from server via `GET /api/workflow/gsd-questions` (a new simple endpoint, or hard-code the question list on client if a new endpoint is too much scope -- prefer fetching to keep server as source of truth).
    - Alternative: Import question definitions directly from a shared module if the types allow it. Since the project has a `shared/` workspace, define the question list in shared/types/wizard.ts and import on both sides. Whichever approach Plan 01 took for the question definitions, align with it here.
    - Track answers in local state `Record<string, string>`.
    - Compute `answeredCount`, `totalRequired`, `allAnswered`.

    **2. Create client/src/components/QualityGateIndicator.tsx (GATE-04):**

    A progress indicator component showing which questions are answered:

    ```typescript
    interface QualityGateIndicatorProps {
      questions: MandatoryQuestion[];
      answers: Record<string, string>;
    }
    ```

    - Render a progress bar (filled portion = answeredCount / totalRequired)
    - Below the bar: "X of Y questions answered" using `t("wizard.gate.progress", { answered, total })`
    - If not all answered: warning text using `t("wizard.gate.blocked")`
    - If all answered: success text "Ready to create project!" using `t("wizard.gate.ready")`
    - Style: progress bar with green fill for answered, gray for remaining. Inline CSSProperties.
    - Adapt the visual pattern from StepProgress.tsx (dot-based) or use a simple horizontal bar.

    **3. Create StepQuestion.tsx:**

    Renders a single GSD question with type-appropriate input:

    ```typescript
    interface StepQuestionProps extends WizardStepProps {
      question: MandatoryQuestion;
      currentIndex: number;
      totalQuestions: number;
      existingAnswer?: string;
    }
    ```

    Implementation:
    - **Progress header:** QualityGateIndicator showing overall progress, plus "Question X of Y"
    - **Question title:** `t(question.titleKey)` rendered as `<h3>`
    - **Question description:** `t(question.descriptionKey)` rendered as `<p>` -- in Expert mode always visible, in Simple mode hidden (use `useMode().isExpert` check). This provides additional context for expert users without cluttering Simple mode.
    - **Input area based on question.type:**
      - `type === "text"`: `<textarea>` with placeholder, minimum length validation from `question.validation`
      - `type === "choice"`: Button group (vertical stack of option buttons). Each button shows `t(option.labelKey)`. Clicking selects and sets the answer.
    - **Navigation:** "Back" button (if not first question) and "Next" button. "Next" disabled until answer is provided. For choice questions, selecting an option can auto-advance (call onComplete immediately).
    - **Pre-fill:** If `existingAnswer` is provided (e.g., from previous wizard visit), pre-populate the input.
    - Calls `onComplete({ [question.id]: answerValue })` to pass the answer to WizardShell's accumulated data.

    **4. Create StepProjectReady.tsx:**

    Final wizard step showing summary and "Create Project" action:

    - Title: "Your project is ready!" (`wizard.gsd.project_ready`)
    - Summary list: Show each answered question with its title and the user's answer (truncated if long)
    - QualityGateIndicator showing 100% completion
    - "Create Project" primary button calls `onComplete({ confirmed: true })`
    - "Back" button calls `onBack?.()` to review/change answers

    **5. Create IdeaToProjectWizard.tsx:**

    The main wizard component that orchestrates the question flow:

    ```typescript
    interface IdeaToProjectWizardProps {
      ideaId: string;
      ideaTitle: string;
      onDone: (gsdAnswers: Record<string, string>) => void;
      onCancel?: () => void;
    }
    ```

    Implementation:
    - Does NOT use WizardShell directly because each step needs a custom question prop. Instead, manages its own step state (similar pattern but with question injection):
      - `useState(0)` for current question index
      - `useState<Record<string, string>>({})` for accumulated answers
    - Renders WizardStepIndicator with question labels (or simplified dots since 6+ steps may overflow the label-based indicator -- use numbered dots instead)
    - For each question index, renders StepQuestion with the corresponding MandatoryQuestion
    - After the last question, renders StepProjectReady
    - On final completion: calls `onDone(answers)` with the collected gsdAnswers
    - Cancel button always available

    Alternative: Use WizardShell with dynamically generated steps array where each step's component is a closure wrapping StepQuestion with the right question. This is cleaner but may be complex. Choose the simpler approach that works.

    **6. Add i18n keys** to both en.json and de.json under `wizard.gsd`:
    ```
    wizard.gsd.title: "Define Your Project" / "Dein Projekt definieren"
    wizard.gsd.intro_title: "Let's define your project" / "Lass uns dein Projekt definieren"
    wizard.gsd.intro_desc: "Answer these questions to turn your idea into a well-defined project." / "Beantworte diese Fragen, um deine Idee in ein klar definiertes Projekt umzuwandeln."
    wizard.gsd.question_of: "Question {{current}} of {{total}}" / "Frage {{current}} von {{total}}"
    wizard.gsd.project_ready: "Your project is ready to be created!" / "Dein Projekt kann jetzt erstellt werden!"
    wizard.gsd.create_project: "Create Project" / "Projekt erstellen"
    wizard.gsd.answer_summary: "Your Answers" / "Deine Antworten"
    wizard.gate.ready: "All questions answered -- ready to create project" / "Alle Fragen beantwortet -- Projekt kann erstellt werden"
    ```
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - All 3 IdeaToProjectWizard files exist in `client/src/components/wizards/IdeaToProjectWizard/`
    - `client/src/components/QualityGateIndicator.tsx` exists
    - `client/src/hooks/useQualityGate.ts` exists
    - StepQuestion renders different inputs for "text" vs "choice" question types
    - Progress indicator shows X of Y questions answered
    - Both en.json and de.json have `wizard.gsd.*` and `wizard.gate.*` keys
  </verify>
  <done>
    IdeaToProjectWizard presents 6 mandatory GSD questions one per screen with progress indicator. Text questions show textarea, choice questions show button group. Final step shows answer summary and "Create Project" button. Expert mode shows question descriptions, Simple mode shows titles only. All text i18n'd in DE and EN.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire quality gate into graduation flow and idea-to-project conversion</name>
  <files>
    client/src/components/IdeaGraduation.tsx
    client/src/pages/IdeaPool.tsx
    client/src/i18n/locales/en.json
    client/src/i18n/locales/de.json
  </files>
  <action>
    **1. Update client/src/components/IdeaGraduation.tsx:**

    The existing IdeaGraduation component handles the propose -> vote -> graduate flow. Modify it to require completing the GSD questioning wizard before graduation can proceed:

    - Add state `showGsdWizard` (boolean, default false)
    - Add state `gsdAnswers` (Record<string, string>, default {})
    - When user clicks "Propose Graduation" (or the equivalent action button):
      - If `gsdAnswers` is empty (wizard not completed), set `showGsdWizard = true` instead of proposing
      - If `gsdAnswers` has values (wizard completed), proceed with existing propose flow
    - When `showGsdWizard` is true, render `IdeaToProjectWizard` as an overlay/replacement
    - IdeaToProjectWizard `onDone` callback: stores `gsdAnswers`, sets `showGsdWizard = false`, then auto-triggers the graduation proposal
    - IdeaToProjectWizard `onCancel`: sets `showGsdWizard = false`
    - When calling the graduation API (POST `/:id/graduate`), include `gsdAnswers` in the request body so the server quality gate can validate
    - Display QualityGateIndicator next to the graduation section showing current gate status

    **Important GATE-03 enforcement:** The wizard shows in BOTH Simple and Expert mode. Do NOT add any mode-based bypass. The only difference is Expert mode shows question descriptions; Simple mode hides them. The gate itself is identical.

    **2. Update IdeaGraduation to pass gsdAnswers to vote/graduate API calls:**

    The existing `useIdeaPool` hook has `proposeGraduation` and `voteOnGraduation` functions. The graduation execution happens server-side when votes are unanimous. To pass gsdAnswers:
    - When the user proposes graduation after completing the wizard, store gsdAnswers as part of the idea's graduation context
    - The simplest approach: include gsdAnswers in the `executeGraduation` call body. Since auto-graduation happens when the final vote is cast, the gsdAnswers need to be available at that point.
    - Pragmatic solution: Store gsdAnswers in component state. When the graduation is proposed, attach gsdAnswers. If auto-graduation triggers on the final vote, the API call should include gsdAnswers. Update the vote API call in `useIdeaPool` to accept optional gsdAnswers parameter.
    - Alternative: Store gsdAnswers on the idea itself (emit an event like `idea.gsd_answers_submitted`) so the server has them. Then the graduation route reads them from the idea state. This is cleaner for the event-sourced architecture.

    Choose the event-sourced approach if feasible within scope:
    - Add a new route `POST /api/ideas/:id/gsd-answers` that accepts `{ answers: Record<string, string> }`, validates against MANDATORY_GSD_QUESTIONS, emits `idea.gsd_answers_submitted` event
    - The graduation route reads the idea's gsdAnswers from its state
    - If this requires too many server changes, fall back to the inline gsdAnswers approach from Plan 01

    **3. Add QualityGateIndicator to idea detail view:**

    In the IdeaPool page or IdeaGraduation component, show QualityGateIndicator for ideas that are in "ready" or "voting" status. This gives users a clear view of what needs to be answered before project creation unlocks (GATE-04).

    **4. Add i18n keys** for graduation integration:
    ```
    wizard.gsd.required_before_graduation: "Answer all project definition questions before proposing graduation" / "Beantworte alle Projektdefinitionsfragen, bevor du die Graduierung vorschl√§gst"
    wizard.gsd.start_questions: "Answer Questions" / "Fragen beantworten"
    wizard.gsd.questions_complete: "Questions completed" / "Fragen abgeschlossen"
    wizard.gsd.edit_answers: "Edit Answers" / "Antworten bearbeiten"
    ```
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - IdeaGraduation.tsx imports and renders IdeaToProjectWizard when user tries to graduate
    - Graduation button is blocked/redirects to wizard when GSD questions are unanswered
    - QualityGateIndicator is visible in the idea detail/graduation area
    - Quality gate applies in both Simple and Expert mode (no mode-based bypass)
    - Both en.json and de.json have `wizard.gsd.*` graduation-related keys
  </verify>
  <done>
    User attempting to graduate an idea must first complete the GSD questioning wizard. Graduation proposal is blocked until all 6 mandatory questions are answered. QualityGateIndicator shows progress. Quality gate enforced identically in Simple and Expert mode (GATE-03). GSD answers are submitted to the server for server-side validation (GATE-01/GATE-02). All text i18n'd.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` -- TypeScript compiles clean
2. IdeaToProjectWizard presents 6 questions one per screen with progress indicator
3. Graduation is blocked until wizard is completed
4. QualityGateIndicator shows answered/remaining progress
5. Quality gate enforced in both Simple and Expert mode
6. StepQuestion shows text input for text questions, button group for choice questions
7. Expert mode shows question descriptions, Simple mode shows titles only
8. All text uses i18n keys in both DE and EN
</verification>

<success_criteria>
- User cannot graduate an idea without answering all 6 mandatory GSD questions
- Questions presented one per screen with clear progress indicator
- Quality gate identical in Simple and Expert mode (GATE-03)
- GSD answers validated server-side (GATE-01, GATE-02)
- Progress indicator shows answered vs remaining (GATE-04)
- All strings i18n'd in DE and EN (WIZ-05)
</success_criteria>

<output>
After completion, create `.planning/phases/17-guided-wizards/17-03-SUMMARY.md`
</output>
