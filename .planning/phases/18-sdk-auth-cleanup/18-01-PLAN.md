---
phase: 18-sdk-auth-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - server/src/agent/session-manager.ts
  - server/package.json
autonomous: true

must_haves:
  truths:
    - "resume() no longer passes persistSession: true to query()"
    - "SDK version is 0.2.38 in package.json"
    - "npm run build completes with zero TypeScript errors"
  artifacts:
    - path: "server/src/agent/session-manager.ts"
      provides: "Clean resume() without deprecated persistSession: true"
      contains: "resume: paused.sdkSessionId"
    - path: "server/package.json"
      provides: "SDK version bump"
      contains: "0.2.38"
  key_links:
    - from: "server/src/agent/session-manager.ts"
      to: "@anthropic-ai/claude-agent-sdk"
      via: "query() import and options"
      pattern: "import.*query.*claude-agent-sdk"
---

<objective>
Remove the deprecated `persistSession: true` from the resume() call in session-manager.ts and bump the Agent SDK from v0.2.37 to v0.2.38 with a clean TypeScript build.

Purpose: Eliminate inconsistent session persistence settings (start uses false, resume uses true) and update to the latest SDK parity release before adding auth features in Plan 18-02.

Output: Clean session-manager.ts with consistent persistSession usage, updated package.json with SDK v0.2.38, zero TypeScript build errors.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@server/src/agent/session-manager.ts
@server/package.json
@.planning/phases/18-sdk-auth-cleanup/18-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove persistSession from resume() and bump SDK to v0.2.38</name>
  <files>server/src/agent/session-manager.ts, server/package.json</files>
  <action>
1. In `server/src/agent/session-manager.ts`, find the `resume()` method (line ~258). In the `query()` call options object, remove the line `persistSession: true,` (line ~268). Do NOT touch the `start()` method which correctly has `persistSession: false` at line ~69.

2. In `server/package.json`, change `"@anthropic-ai/claude-agent-sdk": "^0.2.37"` to `"@anthropic-ai/claude-agent-sdk": "^0.2.38"`.

3. Run `npm install -w server` from the project root to install the updated SDK version.

4. Run `npm run build -w server` (or `cd server && npx tsc --build`) to verify zero TypeScript errors.

Important: The `persistSession: false` in `start()` must remain -- it prevents the SDK from writing session files to `~/.claude/projects/` for server-managed sessions. Only `resume()`'s `persistSession: true` is being removed because it contradicts the start setting and is redundant (the `resume: sessionId` option handles session loading independently).
  </action>
  <verify>
1. `grep -n "persistSession" server/src/agent/session-manager.ts` shows only ONE occurrence (the `false` in `start()`), NOT two.
2. `grep "claude-agent-sdk" server/package.json` shows `0.2.38`.
3. `cd /Users/developer/eluma && npm run build -w server` exits with code 0 and no TypeScript errors.
  </verify>
  <done>
- resume() no longer passes persistSession to query() -- only start() retains persistSession: false
- SDK version is ^0.2.38 in server/package.json
- TypeScript build passes cleanly with zero errors
  </done>
</task>

</tasks>

<verification>
1. `grep -c "persistSession" server/src/agent/session-manager.ts` returns exactly `1` (the false in start())
2. `node -e "const p = require('./server/package.json'); console.log(p.dependencies['@anthropic-ai/claude-agent-sdk'])"` outputs `^0.2.38`
3. `npm run build -w server` completes with exit code 0
4. `node_modules/@anthropic-ai/claude-agent-sdk/package.json` shows version >= 0.2.38
</verification>

<success_criteria>
- persistSession: true removed from resume() in session-manager.ts
- SDK bumped to ^0.2.38 with successful npm install
- TypeScript build passes with zero errors
- start() still has persistSession: false (unchanged)
</success_criteria>

<output>
After completion, create `.planning/phases/18-sdk-auth-cleanup/18-01-SUMMARY.md`
</output>
