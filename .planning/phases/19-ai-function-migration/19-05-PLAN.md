---
phase: 19-ai-function-migration
plan: 05
type: execute
wave: 3
depends_on: ["19-02", "19-03", "19-04"]
files_modified:
  - server/src/ai/providers.ts
  - server/package.json
  - .env
  - .env.example
  - server/src/agent/auth-check.ts
autonomous: true

must_haves:
  truths:
    - "grep -r 'generateText|streamText' server/src/ returns zero matches"
    - "grep -r '@ai-sdk/anthropic|@ai-sdk/openai' server/src/ returns zero matches"
    - "grep -r 'ANTHROPIC_API_KEY|OPENAI_API_KEY' server/ returns only comments explaining removal"
    - "ai, @ai-sdk/anthropic, @ai-sdk/openai packages are uninstalled from server workspace"
    - "providers.ts is deleted (no longer needed)"
  artifacts:
    - path: "server/src/agent/auth-check.ts"
      provides: "Auth check updated for subscription-only model"
      exports: ["checkAgentAuth"]
    - path: ".env"
      provides: "No ANTHROPIC_API_KEY or OPENAI_API_KEY present"
    - path: ".env.example"
      provides: "Updated example with subscription-only auth instructions"
  key_links:
    - from: "server/package.json"
      to: "node_modules"
      via: "ai, @ai-sdk/anthropic, @ai-sdk/openai removed from dependencies"
      pattern: "ai.*@ai-sdk"
---

<objective>
Remove all AI SDK v6 packages, API key references, and the now-unused providers.ts file. Verify zero generateText/streamText calls remain in the codebase.

Purpose: Complete the migration by cleaning up all vestiges of the old AI SDK approach. After this plan, the codebase has zero API key dependencies and zero AI SDK v6 imports.
Output: Clean codebase with only Agent SDK as the AI provider. No API keys needed.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-ai-function-migration/19-RESEARCH.md
@.planning/phases/19-ai-function-migration/19-02-SUMMARY.md
@.planning/phases/19-ai-function-migration/19-03-SUMMARY.md
@.planning/phases/19-ai-function-migration/19-04-SUMMARY.md
@server/src/ai/providers.ts
@server/src/agent/auth-check.ts
@.env
@.env.example
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete providers.ts and verify zero AI SDK imports</name>
  <files>server/src/ai/providers.ts</files>
  <action>
1. **Delete `server/src/ai/providers.ts`** -- this file is the AI SDK provider registry with Anthropic and OpenAI providers. All gateway functions have been migrated to warm session in 19-02/19-03, so nothing imports from this file anymore.
   - Before deleting, verify no remaining imports: `grep -r "providers" server/src/ai/ server/src/search/` -- should return nothing from generate.ts, runner.ts, or engine.ts (only providers.ts itself)

2. **Scan for any remaining AI SDK imports across the entire server:**
   - `grep -r "from \"ai\"" server/src/` -- must return zero matches
   - `grep -r "@ai-sdk/anthropic" server/src/` -- must return zero matches
   - `grep -r "@ai-sdk/openai" server/src/` -- must return zero matches
   - `grep -r "generateText\|streamText" server/src/` -- must return zero matches
   - `grep -r "experimental_transcribe" server/src/` -- must return zero matches

3. **If any remaining references are found**, fix them:
   - Remove the import
   - If the import was functional (not just the files already migrated), update the code to use warm session
   - Log what was found and fixed

4. **Delete `server/src/ai/cost/pricing.ts`** -- the per-token pricing table is no longer needed under subscription model. The cost tracker (19-06) will be rewritten to not use it.
   - Before deleting, verify: `grep -r "pricing" server/src/` should only show the import in `cost/tracker.ts` (which will be rewritten in 19-06)
   - Remove the import from `cost/tracker.ts`: delete `import { MODEL_PRICING } from "./pricing.js"` and the pricing calculation lines. Replace with a simplified version that records zero cost (the full rewrite comes in 19-06, but we need to remove the import now to delete the file).
   - Update `recordAiCost` to not calculate dollar amounts -- just emit the event with `totalCost: 0, inputCost: 0, outputCost: 0` (subscription model)
  </action>
  <verify>
1. providers.ts deleted: `ls server/src/ai/providers.ts 2>&1` returns "No such file"
2. pricing.ts deleted: `ls server/src/ai/cost/pricing.ts 2>&1` returns "No such file"
3. Zero AI SDK imports: `grep -r "from \"ai\"" server/src/` returns no matches
4. Zero @ai-sdk imports: `grep -r "@ai-sdk" server/src/` returns no matches
5. Zero generateText: `grep -r "generateText\|streamText" server/src/` returns no matches
6. tracker.ts compiles: no pricing import
  </verify>
  <done>All AI SDK v6 files deleted. Zero generateText/streamText/AI SDK imports remain in server/src/.</done>
</task>

<task type="auto">
  <name>Task 2: Uninstall AI SDK packages and remove API key references</name>
  <files>server/package.json, .env, .env.example, server/src/agent/auth-check.ts</files>
  <action>
1. **Uninstall AI SDK packages:**
   ```bash
   cd /Users/developer/eluma && npm uninstall ai @ai-sdk/anthropic @ai-sdk/openai -w server --legacy-peer-deps
   ```
   This removes all three packages from `server/package.json` dependencies and updates `package-lock.json`.

2. **Update `.env`:**
   - Ensure no `ANTHROPIC_API_KEY=...` line exists (currently commented out per .env.example, but verify)
   - Ensure no `OPENAI_API_KEY=...` line exists
   - Keep CLAUDE_CODE_OAUTH_TOKEN reference (subscription auth)
   - Add a comment: `# API keys removed in Phase 19 -- all AI calls use Agent SDK subscription auth`

3. **Update `.env.example`:**
   - Remove the `ANTHROPIC_API_KEY` option entirely (not just commented out)
   - Remove `OPENAI_API_KEY` reference
   - Update the Agent SDK Authentication section to only mention subscription auth:
     ```
     # --- Agent SDK Authentication ---
     # Subscription auth (Claude Max quota, zero per-token cost)
     # Run `claude setup-token` to generate, then paste here:
     # CLAUDE_CODE_OAUTH_TOKEN=<token>
     #
     # Note: API keys (ANTHROPIC_API_KEY, OPENAI_API_KEY) were removed in Phase 19.
     # All AI calls use the Agent SDK with subscription auth.
     ```

4. **Update `server/src/agent/auth-check.ts`:**
   - Remove the `ANTHROPIC_API_KEY` detection logic
   - Remove the "both set" warning
   - Simplify to only check for `CLAUDE_CODE_OAUTH_TOKEN`:
     ```typescript
     export function checkAgentAuth(): void {
       const hasOAuthToken = !!process.env.CLAUDE_CODE_OAUTH_TOKEN;
       if (hasOAuthToken) {
         console.log("[agent-auth] Auth method: Subscription (Claude Max quota)");
       } else {
         console.warn(
           "[agent-auth] WARNING: CLAUDE_CODE_OAUTH_TOKEN not set. " +
           "Agent sessions and AI calls will fail. " +
           "Run `claude setup-token` to generate a token."
         );
       }
     }
     ```

5. **Final verification grep commands (run all):**
   - `grep -r "ANTHROPIC_API_KEY" server/` -- must return zero matches (or only in comments explaining removal)
   - `grep -r "OPENAI_API_KEY" server/` -- must return zero matches (or only in comments explaining removal)
   - `grep -r "@ai-sdk" server/package.json` -- must return zero matches
   - `grep "\"ai\"" server/package.json` -- must return zero matches (the ai package dependency)
  </action>
  <verify>
1. Packages removed: `grep -E "\"ai\"|@ai-sdk" server/package.json` returns no matches
2. .env clean: `grep -E "ANTHROPIC_API_KEY|OPENAI_API_KEY" .env` returns no uncommented lines
3. auth-check simplified: `grep "ANTHROPIC_API_KEY" server/src/agent/auth-check.ts` returns no matches
4. Full server scan: `grep -r "ANTHROPIC_API_KEY\|OPENAI_API_KEY" server/src/` returns zero matches (or only in comments)
5. npm install still works: `cd /Users/developer/eluma && npm install --legacy-peer-deps` succeeds
6. TypeScript compiles: error count not increased
  </verify>
  <done>AI SDK packages uninstalled. API keys removed from .env, .env.example, and auth-check.ts. Codebase is API-key-free.</done>
</task>

</tasks>

<verification>
1. `grep -r "generateText\|streamText" server/src/` -- zero matches
2. `grep -r "@ai-sdk/anthropic\|@ai-sdk/openai" server/src/` -- zero matches
3. `grep -r "from \"ai\"" server/src/` -- zero matches
4. `grep -r "ANTHROPIC_API_KEY\|OPENAI_API_KEY" server/` -- zero matches (or comments only)
5. `grep -E "\"ai\"|@ai-sdk" server/package.json` -- zero matches
6. `ls server/src/ai/providers.ts server/src/ai/cost/pricing.ts 2>&1` -- both "No such file"
7. TypeScript error count <= 19
</verification>

<success_criteria>
- Zero AI SDK v6 imports or references in server/src/
- Zero API key references (ANTHROPIC_API_KEY, OPENAI_API_KEY) in active code
- providers.ts and pricing.ts deleted
- ai, @ai-sdk/anthropic, @ai-sdk/openai uninstalled from package.json
- auth-check.ts only checks for CLAUDE_CODE_OAUTH_TOKEN
- .env and .env.example updated for subscription-only auth
- No new TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/19-ai-function-migration/19-05-SUMMARY.md`
</output>
