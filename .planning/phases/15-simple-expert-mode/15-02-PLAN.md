---
phase: 15-simple-expert-mode
plan: 02
type: execute
wave: 2
depends_on: ["15-01"]
files_modified:
  - client/src/pages/Dashboard.tsx
  - client/src/pages/ProjectDetail.tsx
autonomous: true

must_haves:
  truths:
    - "Simple mode shows only Ideas, Projects, and current GSD action — hides Soul Documents, KPI dashboard, AI config, and notification settings"
    - "In Simple mode, detail sections (project metadata, event history) are collapsed by default but can be expanded by clicking"
    - "Expert mode displays every feature exactly as it works today with zero behavior changes"
  artifacts:
    - path: "client/src/pages/Dashboard.tsx"
      provides: "Conditional section visibility based on mode"
      contains: "useMode"
    - path: "client/src/pages/ProjectDetail.tsx"
      provides: "Collapsible sections in Simple mode, hidden KPI sidebar"
      contains: "CollapsibleSection"
  key_links:
    - from: "client/src/pages/Dashboard.tsx"
      to: "client/src/hooks/useMode.ts"
      via: "useMode().isExpert for section visibility"
      pattern: "isExpert"
    - from: "client/src/pages/ProjectDetail.tsx"
      to: "client/src/hooks/useMode.ts"
      via: "useMode().isExpert for collapse defaults and KPI visibility"
      pattern: "isExpert"
---

<objective>
Apply mode-conditional rendering to Dashboard and ProjectDetail pages. Dashboard hides KPI overview, AI team member widget, TeamManager, and ActivityFeed in Simple mode. ProjectDetail collapses Phase Timeline and Phase History by default in Simple mode (expandable on click) and hides the KPI sidebar entirely.

Purpose: Completes the Simple/Expert mode feature by making page content adapt to the selected mode. After this plan, Simple mode users see a clean, focused interface while Expert mode remains unchanged.
Output: Modified Dashboard.tsx and ProjectDetail.tsx with mode-aware rendering.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-simple-expert-mode/15-RESEARCH.md
@.planning/phases/15-simple-expert-mode/15-01-SUMMARY.md
@client/src/pages/Dashboard.tsx
@client/src/pages/ProjectDetail.tsx
@client/src/hooks/useMode.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Apply mode-conditional rendering to Dashboard.tsx</name>
  <files>
    client/src/pages/Dashboard.tsx
  </files>
  <action>
    Modify `client/src/pages/Dashboard.tsx` to hide sections in Simple mode:

    **1. Add import:**
    ```typescript
    import { useMode } from "../hooks/useMode.js";
    ```

    **2. Add hook call** inside the `Dashboard` component, after existing hooks:
    ```typescript
    const { isExpert } = useMode();
    ```

    **3. Conditionally render sections based on mode:**

    The visibility map (from RESEARCH.md):
    | Section | Simple | Expert |
    |---------|--------|--------|
    | Welcome header + LanguageSwitcher | Visible | Visible |
    | AI Team Member widget | Hidden | Visible |
    | Project Overview (KPI cards + pie chart) | Hidden | Visible |
    | Project Tabs + List | Visible | Visible |
    | Team Manager panel | Hidden | Visible |
    | Activity Feed panel | Hidden | Visible |

    **Specific changes:**

    a) **AI Team Member section** — wrap the existing `{team && (...aiMemberSection...)}` block:
    ```tsx
    {isExpert && team && (
      <div style={styles.aiMemberSection}>
        <AiTeamMember teamId={team.id} />
      </div>
    )}
    ```

    b) **Project Overview section** (overviewSection with KPI cards, pie chart, aggregated KPIs) — wrap the existing `{team && overview && overview.totalProjects > 0 && (...overviewSection...)}` block:
    ```tsx
    {isExpert && team && overview && overview.totalProjects > 0 && (
      <div style={styles.overviewSection}>
        ... (existing content unchanged)
      </div>
    )}
    ```

    c) **Bottom grid** (TeamManager + ActivityFeed) — wrap the entire `<div style={styles.grid}>` block:
    ```tsx
    {isExpert && (
      <div style={styles.grid}>
        <div style={styles.leftPanel}>
          <TeamManager ... />
        </div>
        <div style={styles.rightPanel}>
          <ActivityFeed />
        </div>
      </div>
    )}
    ```

    d) **Keep visible always:** Welcome section (with LanguageSwitcher) and Project Tabs + List section.

    **CRITICAL: Do NOT change any existing JSX, styles, or logic.** Only add `isExpert &&` conditions around existing blocks. Expert mode must render identically to pre-change behavior.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - In Expert mode: Dashboard looks exactly like before (AI widget, KPI overview, project list, team manager, activity feed all visible)
    - In Simple mode: Dashboard shows only welcome header with LanguageSwitcher, then project tabs + project list. No AI widget, no KPI overview, no team manager, no activity feed.
    - Toggle between modes: sections appear/disappear immediately
  </verify>
  <done>
    Dashboard shows full content in Expert mode (zero changes from pre-modification behavior). Simple mode shows only welcome section and project list. No regressions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Apply collapsible sections and KPI hiding to ProjectDetail.tsx</name>
  <files>
    client/src/pages/ProjectDetail.tsx
  </files>
  <action>
    Modify `client/src/pages/ProjectDetail.tsx` to collapse sections in Simple mode and hide the KPI sidebar:

    **1. Add import:**
    ```typescript
    import { useMode } from "../hooks/useMode.js";
    ```

    **2. Create a `CollapsibleSection` component** inside the file (above the `ProjectDetail` default export):

    ```typescript
    function CollapsibleSection({
      title,
      defaultOpen,
      children,
    }: {
      title: string;
      defaultOpen: boolean;
      children: React.ReactNode;
    }) {
      const [open, setOpen] = useState(defaultOpen);
      const { isExpert } = useMode();

      // When switching to Expert mode, ensure sections are expanded
      useEffect(() => {
        if (isExpert) setOpen(true);
      }, [isExpert]);

      return (
        <div style={pageStyles.section}>
          <button
            type="button"
            onClick={() => setOpen(!open)}
            style={collapsibleStyles.header}
            aria-expanded={open}
          >
            <h2 style={pageStyles.sectionTitle}>{title}</h2>
            <span style={collapsibleStyles.chevron}>{open ? "\u25B2" : "\u25BC"}</span>
          </button>
          {open && <div>{children}</div>}
        </div>
      );
    }
    ```

    Add the `useEffect` import at the top of the file (it is NOT currently imported — the file uses `useState` from React but not `useEffect`):
    ```typescript
    import { useState, useEffect } from "react";
    ```

    Add styles for collapsible header (add to file, near the `pageStyles` object or as a separate const):
    ```typescript
    const collapsibleStyles: Record<string, React.CSSProperties> = {
      header: {
        display: "flex",
        justifyContent: "space-between",
        alignItems: "center",
        width: "100%",
        padding: "0",
        margin: "0 0 0.5rem 0",
        backgroundColor: "transparent",
        border: "none",
        cursor: "pointer",
        fontFamily: "inherit",
      },
      chevron: {
        fontSize: "0.75rem",
        color: "#9ca3af",
        marginLeft: "0.5rem",
      },
    };
    ```

    **3. Add hook call** in the `ProjectDetail` component, after existing hooks:
    ```typescript
    const { isExpert } = useMode();
    ```

    **4. Apply CollapsibleSection to Phase Timeline:**

    Replace the current Phase Timeline section:
    ```tsx
    {/* Phase timeline */}
    <div style={pageStyles.section}>
      <h2 style={pageStyles.sectionTitle}>{t("project_detail.phase_timeline")}</h2>
      <div style={pageStyles.card}>
        <PhaseTimeline ... />
        {viewingPhase && (...)}
      </div>
    </div>
    ```

    With:
    ```tsx
    {/* Phase timeline */}
    <CollapsibleSection
      title={t("project_detail.phase_timeline")}
      defaultOpen={isExpert}
    >
      <div style={pageStyles.card}>
        <PhaseTimeline
          currentPhase={project.currentPhase}
          phases={project.phases}
          onPhaseClick={handlePhaseClick}
        />
        {viewingPhase && (
          <div style={pageStyles.viewingPhaseBar}>
            <span style={pageStyles.viewingPhaseText}>
              {t("phase_content.viewing_phase", {
                phase: t(PHASE_CONFIG[viewingPhase].labelKey),
              })}
            </span>
            <button
              type="button"
              onClick={handleClearViewingPhase}
              style={pageStyles.clearViewButton}
            >
              {t("phase_content.back_to_current")}
            </button>
          </div>
        )}
      </div>
    </CollapsibleSection>
    ```

    **5. Apply CollapsibleSection to Phase History** (the viewingPhase && PhaseManagement section):

    The Phase Management section inside `mainColumn` currently renders only when `viewingPhase` is truthy. This section is already conditionally rendered and is expert-level detail. Wrap it in an `isExpert` conditional for Simple mode:
    ```tsx
    {isExpert && viewingPhase && (
      <div style={pageStyles.section}>
        <h2 style={pageStyles.sectionTitle}>{t("phase_mgmt.title")}</h2>
        <PhaseManagement ... />
      </div>
    )}
    ```

    Actually, reconsidering: the Phase Management panel only appears when the user clicks a completed phase in the timeline. It's a workflow action, not metadata. Keep it visible in both modes but only when viewingPhase is set. Do NOT wrap it in isExpert.

    **6. Hide KPI sidebar in Simple mode:**

    The two-column layout `<div style={pageStyles.columns}>` contains `mainColumn` (left) and `sideColumn` (right). In Simple mode, hide the entire `sideColumn` and make `mainColumn` take full width.

    Replace the columns section:
    ```tsx
    <div style={isExpert ? pageStyles.columns : pageStyles.mainColumn}>
      {/* Left: WorkflowEngine or PhaseContent */}
      <div style={isExpert ? pageStyles.mainColumn : undefined}>
        <div style={pageStyles.section}>
          ... (existing WorkflowEngine/PhaseContent content unchanged)
        </div>

        {/* Phase Management panel */}
        {viewingPhase && (
          <div style={pageStyles.section}>
            <h2 style={pageStyles.sectionTitle}>{t("phase_mgmt.title")}</h2>
            <PhaseManagement ... />
          </div>
        )}
      </div>

      {/* Right: KPI sidebar — Expert only */}
      {isExpert && (
        <div style={pageStyles.sideColumn}>
          <RoiKpiCard kpis={project.roiKpis} />
          {!project.archived && (
            <div style={pageStyles.kpiFormWrapper}>
              <RoiKpiForm onSubmit={handleAddKpi} isSubmitting={kpiSubmitting} />
            </div>
          )}
        </div>
      )}
    </div>
    ```

    **7. Keep always visible (both modes):**
    - ProjectTabs (project switching)
    - Project header (name, phase badge, archived indicator)
    - ProjectInfo (editable name/description)
    - AgentPanel (GSD action — this IS the "current GSD action" from MODE-03)
    - WorkflowEngine (current phase guided steps)
    - PhaseContent (when viewing history)
    - PhaseManagement (when viewing completed phase)

    **CRITICAL: Expert mode must render identically to pre-change behavior.** The `CollapsibleSection` component uses `useEffect` to force-open sections when switching to Expert mode. In Expert mode, `defaultOpen={isExpert}` is `true`, so sections start open. The chevron indicator is subtle (small gray arrows) and does not change the visual weight of the section.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - In Expert mode: ProjectDetail looks exactly like before — Phase Timeline open, KPI sidebar visible on right, two-column layout
    - In Simple mode: Phase Timeline section has a clickable header with chevron, starts collapsed. Click to expand — shows PhaseTimeline. KPI sidebar is gone, main content is full width.
    - In Simple mode: AgentPanel and WorkflowEngine are visible (GSD action accessible)
    - Toggle from Simple to Expert: collapsed sections auto-expand, KPI sidebar appears
    - Toggle from Expert to Simple: sections collapse, KPI sidebar disappears
  </verify>
  <done>
    ProjectDetail collapses Phase Timeline by default in Simple mode (expandable by click). KPI sidebar hidden in Simple mode. AgentPanel and WorkflowEngine remain visible. Expert mode is identical to pre-change behavior. Dashboard sections correctly hidden/shown per mode.
  </done>
</task>

</tasks>

<verification>
1. Expert mode Dashboard: AI Team Member widget, KPI overview section, project tabs + list, team manager, activity feed — all visible, identical to pre-change.
2. Simple mode Dashboard: only welcome section + project tabs and list visible. No AI widget, no KPI overview, no team manager, no activity feed.
3. Expert mode ProjectDetail: Phase Timeline open, two-column layout with KPI sidebar, all sections visible — identical to pre-change.
4. Simple mode ProjectDetail: Phase Timeline collapsed with chevron (click expands it). No KPI sidebar. Full-width main content. AgentPanel visible. WorkflowEngine visible.
5. Toggle modes on Dashboard: sections appear/disappear immediately.
6. Toggle modes on ProjectDetail: Timeline auto-expands when switching to Expert, collapses when switching to Simple. KPI sidebar appears/disappears.
7. Combined with Plan 01: Full end-to-end flow — toggle in header, nav links change, page content adapts, routes guarded, mode persists.
</verification>

<success_criteria>
- Simple mode Dashboard: welcome + project list only (KPI, AI widget, team manager, activity feed hidden)
- Simple mode ProjectDetail: Phase Timeline collapsed-by-default (expandable), KPI sidebar hidden, full-width layout, AgentPanel + WorkflowEngine visible
- Expert mode: both pages identical to pre-change behavior (zero regressions)
- Switching modes immediately updates visible sections
- CollapsibleSection auto-expands when switching to Expert mode
- All 5 requirements (MODE-01 through MODE-05) satisfied across Plan 01 + Plan 02
</success_criteria>

<output>
After completion, create `.planning/phases/15-simple-expert-mode/15-02-SUMMARY.md`
</output>
