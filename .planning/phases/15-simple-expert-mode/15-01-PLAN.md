---
phase: 15-simple-expert-mode
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - client/src/hooks/useMode.ts
  - client/src/components/ModeToggle.tsx
  - client/src/components/ExpertRoute.tsx
  - client/src/App.tsx
  - client/src/i18n/locales/en.json
  - client/src/i18n/locales/de.json
autonomous: true

must_haves:
  truths:
    - "User can toggle between Simple and Expert mode via a switch in the app header"
    - "Mode preference survives page reload and new browser sessions (persisted in localStorage)"
    - "Expert mode displays every feature exactly as it works today with zero behavior changes"
    - "Simple mode hides Soul Docs, AI, Integrations, and Settings nav links"
    - "Navigating to an expert-only URL in Simple mode redirects to /home"
  artifacts:
    - path: "client/src/hooks/useMode.ts"
      provides: "ModeProvider context and useMode hook"
      exports: ["ModeProvider", "useMode"]
    - path: "client/src/components/ModeToggle.tsx"
      provides: "Simple/Expert toggle button for header"
      exports: ["ModeToggle"]
    - path: "client/src/components/ExpertRoute.tsx"
      provides: "Route guard that redirects to /home when in Simple mode"
      exports: ["ExpertRoute"]
    - path: "client/src/App.tsx"
      provides: "ModeProvider wrapping all routes, conditional nav, ExpertRoute guards"
      contains: "ModeProvider"
  key_links:
    - from: "client/src/hooks/useMode.ts"
      to: "localStorage"
      via: "getItem/setItem with key eluma-mode"
      pattern: "localStorage\\.(get|set)Item.*eluma-mode"
    - from: "client/src/App.tsx"
      to: "client/src/hooks/useMode.ts"
      via: "ModeProvider wrapping routes and useMode in AppLayout"
      pattern: "ModeProvider|useMode"
    - from: "client/src/App.tsx"
      to: "client/src/components/ExpertRoute.tsx"
      via: "ExpertRoute wrapping /soul, /ai, /integrations, /settings routes"
      pattern: "ExpertRoute"
    - from: "client/src/components/ModeToggle.tsx"
      to: "client/src/hooks/useMode.ts"
      via: "useMode hook for reading/setting mode"
      pattern: "useMode"
---

<objective>
Create the Simple/Expert mode infrastructure: ModeProvider context with localStorage persistence, ModeToggle header component, ExpertRoute guard, and integrate all three into App.tsx with conditional navigation links and route protection.

Purpose: Establishes the complete mode switching system so Plan 02 can apply conditional rendering to individual pages. After this plan, toggling works, nav links hide/show correctly, and expert-only routes are guarded.
Output: useMode.ts, ModeToggle.tsx, ExpertRoute.tsx, modified App.tsx, i18n keys in both locale files.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-simple-expert-mode/15-RESEARCH.md
@client/src/App.tsx
@client/src/hooks/useAuth.tsx
@client/src/components/LanguageSwitcher.tsx
@client/src/components/ProtectedRoute.tsx
@client/src/i18n/locales/en.json
@client/src/i18n/locales/de.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useMode hook, ModeToggle component, ExpertRoute guard, and i18n keys</name>
  <files>
    client/src/hooks/useMode.ts
    client/src/components/ModeToggle.tsx
    client/src/components/ExpertRoute.tsx
    client/src/i18n/locales/en.json
    client/src/i18n/locales/de.json
  </files>
  <action>
    **1. Create `client/src/hooks/useMode.ts`** — React Context + Provider + hook mirroring the `useAuth.tsx` pattern:
    - Type `UXMode = "simple" | "expert"`
    - localStorage key: `"eluma-mode"`
    - Default to `"simple"` when no localStorage value exists (aligns with phase goal of non-technical user accessibility)
    - `ModeContextValue` interface: `{ mode: UXMode; isExpert: boolean; isSimple: boolean; setMode: (m: UXMode) => void; toggleMode: () => void }`
    - `ModeProvider` component with `useState` initialized from `localStorage.getItem(MODE_KEY) as UXMode || "simple"`
    - `setMode` callback: writes to localStorage then sets state
    - `toggleMode` callback: uses `setModeState(prev => ...)` functional updater (not stale closure) to toggle and persist
    - `useMode()` hook that reads context and throws if used outside provider
    - Export both `ModeProvider` and `useMode`

    **2. Create `client/src/components/ModeToggle.tsx`** — Toggle component mirroring `LanguageSwitcher.tsx`:
    - Import `useTranslation` from `react-i18next` (per CLAUDE.md convention, NOT useLanguage)
    - Import `useMode` from `../hooks/useMode.js`
    - Two-button pill toggle: "Simple" and "Expert" buttons
    - Active button: blue background (#2563eb), white text, bold
    - Inactive button: light gray background (#f9fafb), dark text, normal weight
    - Use `aria-pressed` and `aria-label` for accessibility
    - Style object mirrors LanguageSwitcher exactly: inline-flex container, 4px border-radius, 1px solid #d1d5db border, 0.75rem font-size
    - Labels use `t("mode.simple")` and `t("mode.expert")`

    **3. Create `client/src/components/ExpertRoute.tsx`** — Route guard mirroring `ProtectedRoute.tsx`:
    - Import `Navigate` from `react-router-dom`
    - Import `useMode` from `../hooks/useMode.js`
    - If `isSimple` is true, return `<Navigate to="/home" replace />`
    - Otherwise render children
    - Export named `ExpertRoute`

    **4. Add i18n keys to both locale files:**

    In `en.json`, add a `"mode"` section:
    ```json
    "mode": {
      "simple": "Simple",
      "expert": "Expert",
      "toggle_label": "UI Mode"
    }
    ```

    In `de.json`, add a `"mode"` section:
    ```json
    "mode": {
      "simple": "Einfach",
      "expert": "Experte",
      "toggle_label": "UI-Modus"
    }
    ```

    Place the `"mode"` section after the last existing top-level key in each file (maintain alphabetical or existing order).
  </action>
  <verify>
    - `npx tsc --noEmit` passes with no type errors
    - `useMode.ts` exports `ModeProvider` and `useMode`
    - `ModeToggle.tsx` exports `ModeToggle`
    - `ExpertRoute.tsx` exports `ExpertRoute`
    - Both `de.json` and `en.json` contain `mode.simple`, `mode.expert`, `mode.toggle_label` keys
  </verify>
  <done>
    Three new files created and type-check clean. i18n keys present in both locales.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate ModeProvider, ModeToggle, conditional nav, and ExpertRoute into App.tsx</name>
  <files>
    client/src/App.tsx
  </files>
  <action>
    Modify `client/src/App.tsx` to wire up the entire mode system:

    **1. Add imports at top of file:**
    ```typescript
    import { ModeProvider, useMode } from "./hooks/useMode.js";
    import { ModeToggle } from "./components/ModeToggle.js";
    import { ExpertRoute } from "./components/ExpertRoute.js";
    ```

    **2. Wrap routes in ModeProvider** in the `App` component:
    - Place `<ModeProvider>` inside `<AuthProvider>` but outside `<Routes>`
    - This ensures all routes and AppLayout have access to useMode()
    ```tsx
    <AuthProvider>
      <ModeProvider>
        <Routes>...</Routes>
      </ModeProvider>
    </AuthProvider>
    ```

    **3. Conditional navigation in `AppLayout`:**
    - Add `const { isExpert } = useMode();` after existing hooks
    - Wrap Soul Docs nav button in `{isExpert && (...)}`
    - Wrap AI nav button in `{isExpert && (...)}`
    - Wrap Integrations nav button in `{isExpert && (...)}`
    - Keep Dashboard, Projects, Idea Pool buttons always visible (no change)

    **4. Add ModeToggle and conditional Settings in headerRight:**
    - Add `<ModeToggle />` as the FIRST element in the `headerRight` div (before NotificationBell)
    - Wrap the Settings button in `{isExpert && (...)}`
    - Keep NotificationBell always visible
    - Keep user name and Sign out button always visible

    **5. Wrap expert-only routes with ExpertRoute:**
    - `/ai` route: add `<ExpertRoute>` inside `<ProtectedRoute>`, wrapping `<AppLayout><AiDashboard /></AppLayout>`
    - `/integrations` route: same pattern with `<ExpertRoute>`
    - `/settings/notifications` route: same pattern with `<ExpertRoute>`
    - `/soul` route (SoulRedirect): same pattern with `<ExpertRoute>`
    - `/soul/meta/:teamId` route: same pattern with `<ExpertRoute>`
    - `/soul/:userId` route: same pattern with `<ExpertRoute>`
    - `/settings` redirect route: same pattern with `<ExpertRoute>`
    - Do NOT wrap `/home`, `/projects`, `/projects/:id`, `/ideas`, `/project/:id` — these are always accessible

    Pattern for expert-only routes:
    ```tsx
    <Route path="/ai" element={
      <ProtectedRoute>
        <ExpertRoute>
          <AppLayout><AiDashboard /></AppLayout>
        </ExpertRoute>
      </ProtectedRoute>
    } />
    ```

    **CRITICAL: Expert mode must be identical to current behavior.** All changes are additive (wrapping in conditionals). No existing JSX structure, styles, or logic should be altered — only wrapped or conditionally rendered.
  </action>
  <verify>
    - `npx tsc --noEmit` passes with no type errors
    - `npm run dev` starts without errors
    - In browser: ModeToggle visible in header between Eluma logo area and NotificationBell
    - Toggle to Expert: all 6 nav links visible (Dashboard, Projects, Idea Pool, Soul Docs, AI, Integrations), Settings visible
    - Toggle to Simple: only 3 nav links visible (Dashboard, Projects, Idea Pool), Settings hidden
    - In Simple mode: navigate to `/ai` via URL bar — should redirect to `/home`
    - In Simple mode: navigate to `/soul` via URL bar — should redirect to `/home`
    - In Simple mode: navigate to `/integrations` via URL bar — should redirect to `/home`
    - In Expert mode: all routes work as before
    - Refresh page: mode persists (check localStorage has `eluma-mode` key)
  </verify>
  <done>
    ModeToggle renders in header. Simple mode hides Soul Docs/AI/Integrations/Settings nav links and guards those routes. Expert mode shows everything identically to pre-change behavior. Mode persists across page reload via localStorage.
  </done>
</task>

</tasks>

<verification>
1. Toggle to Expert mode. Verify ALL nav links present: Dashboard, Projects, Idea Pool, Soul Docs, AI, Integrations. Settings button visible.
2. Navigate to /ai, /soul, /integrations, /settings/notifications — all load normally.
3. Toggle to Simple mode. Verify ONLY: Dashboard, Projects, Idea Pool visible. No Soul Docs, AI, Integrations, Settings.
4. In Simple mode, manually navigate to /ai — redirects to /home.
5. In Simple mode, manually navigate to /soul — redirects to /home.
6. In Simple mode, manually navigate to /integrations — redirects to /home.
7. In Simple mode, manually navigate to /settings/notifications — redirects to /home.
8. Refresh page in Simple mode — still Simple mode (localStorage persists).
9. Refresh page in Expert mode — still Expert mode (localStorage persists).
10. Clear localStorage, reload — defaults to Simple mode.
</verification>

<success_criteria>
- ModeToggle visible in app header for all authenticated pages
- Simple mode: 3 nav links (Dashboard, Projects, Idea Pool), no Settings button
- Expert mode: 6 nav links + Settings button (identical to pre-change UI)
- Expert-only routes redirect to /home in Simple mode
- Mode persists across page reload via localStorage key "eluma-mode"
- Default mode is "simple" when no localStorage value exists
- All text uses i18n keys, renders correctly in both DE and EN
- Zero regressions in Expert mode behavior
</success_criteria>

<output>
After completion, create `.planning/phases/15-simple-expert-mode/15-01-SUMMARY.md`
</output>
