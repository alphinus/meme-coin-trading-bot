---
phase: 21-stabilization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - server/src/routes/gsd.ts
  - client/src/App.tsx
  - client/src/components/AgentOutput.tsx
  - client/src/pages/IdeaPool.tsx
  - client/src/i18n/locales/en.json
  - client/src/i18n/locales/de.json
autonomous: true

must_haves:
  truths:
    - "Navigation labels (Dashboard, Projects, Idea Pool, Soul Docs, AI, Integrations, Settings, Sign out) render in the active language, not hardcoded English"
    - "Agent tool progress labels (Reading file, Searching code, etc.) render in the active language"
    - "IdeaPool page strings (loading, empty state, section headers, action buttons) render in the active language"
    - "server/src/routes/gsd.ts compiles without the incorrect import path error"
  artifacts:
    - path: "server/src/routes/gsd.ts"
      provides: "Corrected import path for workflow definitions"
      contains: "../workflow/definitions.js"
    - path: "client/src/App.tsx"
      provides: "i18n-enabled navigation labels"
      contains: "t(\"nav."
    - path: "client/src/components/AgentOutput.tsx"
      provides: "i18n-enabled tool labels"
      contains: "t(\"agent.tool_label."
    - path: "client/src/pages/IdeaPool.tsx"
      provides: "i18n-enabled page strings"
      contains: "t(\"idea_pool."
    - path: "client/src/i18n/locales/en.json"
      provides: "English translations for nav, tool labels, idea pool"
      contains: "tool_label"
    - path: "client/src/i18n/locales/de.json"
      provides: "German translations for nav, tool labels, idea pool"
      contains: "tool_label"
  key_links:
    - from: "client/src/App.tsx"
      to: "client/src/i18n/locales/en.json"
      via: "useTranslation t() calls"
      pattern: "t\\(\"nav\\."
    - from: "client/src/components/AgentOutput.tsx"
      to: "client/src/i18n/locales/en.json"
      via: "useTranslation t() calls"
      pattern: "t\\(\"agent\\.tool_label\\."
---

<objective>
Fix the known gsd.ts import path bug and replace all identified hardcoded English strings with i18n t() calls in App.tsx navigation, AgentOutput.tsx tool labels, and IdeaPool.tsx page text.

Purpose: Eliminate mixed-language UI when German is active. Fix the one in-scope TypeScript compilation error. These are pre-discovered issues from research -- no scanning needed, just targeted fixes.

Output: 6 files modified, zero new hardcoded English strings in the identified locations, gsd.ts import error resolved.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-stabilization/21-RESEARCH.md

# Source files to modify
@server/src/routes/gsd.ts
@client/src/App.tsx
@client/src/components/AgentOutput.tsx
@client/src/pages/IdeaPool.tsx
@client/src/i18n/locales/en.json
@client/src/i18n/locales/de.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix gsd.ts import path and add missing nav i18n keys</name>
  <files>
    server/src/routes/gsd.ts
    client/src/App.tsx
    client/src/i18n/locales/en.json
    client/src/i18n/locales/de.json
  </files>
  <action>
**1. Fix gsd.ts import path (line 24):**

Change:
```typescript
import { getStepsForPhase } from "../../workflow/definitions.js";
```
To:
```typescript
import { getStepsForPhase } from "../workflow/definitions.js";
```

The file is at `server/src/routes/gsd.ts` and needs to reach `server/src/workflow/definitions.js` -- that's one directory up (`../`), not two (`../../`).

**2. Add missing nav i18n keys to both locale files:**

The `nav` section in en.json currently has: `dashboard`, `settings`, `logout`, `ideaPool`. It is MISSING: `projects`, `soulDocs`, `ai`, `integrations`, `signOut`.

Add to en.json `nav` object:
```json
"projects": "Projects",
"soulDocs": "Soul Docs",
"ai": "AI",
"integrations": "Integrations",
"signOut": "Sign out"
```

Add to de.json `nav` object:
```json
"projects": "Projekte",
"soulDocs": "Soul Docs",
"ai": "KI",
"integrations": "Integrationen",
"signOut": "Abmelden"
```

Note: "Eluma" is a brand name -- do NOT internationalize it. Keep it hardcoded.

**3. Replace hardcoded navigation strings in App.tsx with t() calls:**

App.tsx already imports from react-router-dom and uses hooks. It needs `useTranslation` (or `useLanguage` -- check which pattern is already used in the file). If neither is imported, add `import { useTranslation } from "react-i18next";` and call `const { t } = useTranslation();` in the AppLayout component.

Replace these hardcoded strings in the AppLayout component:
- `>Dashboard</button>` → `>{t("nav.dashboard")}</button>`
- `>Projects</button>` → `>{t("nav.projects")}</button>`
- `>Idea Pool</button>` → `>{t("nav.ideaPool")}</button>`
- `>Soul Docs</button>` → `>{t("nav.soulDocs")}</button>`
- `>AI</button>` → `>{t("nav.ai")}</button>`
- `>Integrations</button>` → `>{t("nav.integrations")}</button>`
- `>Settings</button>` → `>{t("nav.settings")}</button>`
- `>Sign out</button>` → `>{t("nav.signOut")}</button>`

Do NOT change "Eluma" in the logo span.
  </action>
  <verify>
1. `cd /Users/developer/eluma && npx tsc --noEmit -p client/tsconfig.json 2>&1 | head -20` -- should show zero errors (client was already clean)
2. `grep '../workflow/definitions.js' server/src/routes/gsd.ts` -- should match the corrected import
3. `grep -c 'nav\.' client/src/App.tsx` -- should show 8 matches (one per nav label)
4. Verify both locale files have the new nav keys: `node -e "const en=require('./client/src/i18n/locales/en.json'); console.log(Object.keys(en.nav));"` should list all 9 keys
  </verify>
  <done>
gsd.ts import path uses `../workflow/definitions.js` (one level up, not two). App.tsx navigation labels all use t("nav.*") calls. Both en.json and de.json contain all nav keys including projects, soulDocs, ai, integrations, signOut.
  </done>
</task>

<task type="auto">
  <name>Task 2: Internationalize AgentOutput tool labels and IdeaPool hardcoded strings</name>
  <files>
    client/src/components/AgentOutput.tsx
    client/src/pages/IdeaPool.tsx
    client/src/i18n/locales/en.json
    client/src/i18n/locales/de.json
  </files>
  <action>
**1. Internationalize AgentOutput.tsx TOOL_LABELS (lines 36-47):**

AgentOutput.tsx already imports `useTranslation` from react-i18next (line 19). The `t` function is likely already destructured in the component body.

Replace the static `TOOL_LABELS` object with a function that uses `t()`. Two approaches (pick the cleaner one):

Option A -- Map to i18n keys instead of strings:
```typescript
const TOOL_LABEL_KEYS: Record<string, string> = {
  Read: "agent.tool_label.read",
  Glob: "agent.tool_label.glob",
  Grep: "agent.tool_label.grep",
  WebSearch: "agent.tool_label.web_search",
  WebFetch: "agent.tool_label.web_fetch",
  Edit: "agent.tool_label.edit",
  Write: "agent.tool_label.write",
  Bash: "agent.tool_label.bash",
  Task: "agent.tool_label.task",
  TodoWrite: "agent.tool_label.todo_write",
};
```
Then where TOOL_LABELS is used (e.g., `TOOL_LABELS[tool.name]`), replace with `t(TOOL_LABEL_KEYS[tool.name])` or a helper function `getToolLabel(tool.name, t)`.

Add to en.json inside the existing `"agent"` object:
```json
"tool_label": {
  "read": "Reading file...",
  "glob": "Finding files...",
  "grep": "Searching code...",
  "web_search": "Searching the web...",
  "web_fetch": "Fetching web page...",
  "edit": "Editing file...",
  "write": "Writing file...",
  "bash": "Running command...",
  "task": "Delegating task...",
  "todo_write": "Tracking task..."
}
```

Add to de.json inside the existing `"agent"` object:
```json
"tool_label": {
  "read": "Datei lesen...",
  "glob": "Dateien suchen...",
  "grep": "Code durchsuchen...",
  "web_search": "Web durchsuchen...",
  "web_fetch": "Webseite abrufen...",
  "edit": "Datei bearbeiten...",
  "write": "Datei schreiben...",
  "bash": "Befehl ausführen...",
  "task": "Aufgabe delegieren...",
  "todo_write": "Aufgabe verfolgen..."
}
```

**2. Internationalize IdeaPool.tsx hardcoded strings:**

IdeaPool.tsx already imports `useLanguage` (line 14) and destructures `{ currentLanguage, t }` (line 25). Use the existing `t` function.

Add an `"idea_pool"` section to both locale files (if it doesn't already exist -- check first). If sections like `ideaRefinement` or `ideaGraduation` exist nearby, place `idea_pool` logically near them.

Add to en.json:
```json
"idea_pool": {
  "login_required": "Please log in to access the Idea Pool.",
  "where_should_go": "Where should this go?",
  "dismiss": "Dismiss",
  "analyzing": "Analyzing your input...",
  "your_input": "Your input:",
  "loading": "Loading ideas...",
  "title": "Ideas",
  "empty": "No ideas yet...",
  "subtitle": "Capture ideas by voice or text, refine them with AI, and graduate the best ones into full projects.",
  "archived": "Archived",
  "close": "Close",
  "archive_idea": "Archive Idea",
  "archived_message": "This idea has been archived."
}
```

Add to de.json:
```json
"idea_pool": {
  "login_required": "Bitte melde dich an, um auf den Ideenpool zuzugreifen.",
  "where_should_go": "Wohin soll das?",
  "dismiss": "Verwerfen",
  "analyzing": "Eingabe wird analysiert...",
  "your_input": "Deine Eingabe:",
  "loading": "Ideen werden geladen...",
  "title": "Ideen",
  "empty": "Noch keine Ideen...",
  "subtitle": "Erfasse Ideen per Sprache oder Text, verfeinere sie mit KI und mache die besten zu vollständigen Projekten.",
  "archived": "Archiviert",
  "close": "Schließen",
  "archive_idea": "Idee archivieren",
  "archived_message": "Diese Idee wurde archiviert."
}
```

Then replace each hardcoded string in IdeaPool.tsx with the corresponding `t()` call:
- `"Please log in to access the Idea Pool."` → `t("idea_pool.login_required")`
- `"Where should this go?"` → `t("idea_pool.where_should_go")`
- `"Dismiss"` → `t("idea_pool.dismiss")`
- `"Analyzing your input..."` → `t("idea_pool.analyzing")`
- `"Your input:"` → `t("idea_pool.your_input")`
- `"Loading ideas..."` → `t("idea_pool.loading")`
- `"Ideas"` → `t("idea_pool.title")`
- `"No ideas yet..."` → `t("idea_pool.empty")`
- The subtitle paragraph → `t("idea_pool.subtitle")`
- `"Archived"` → `t("idea_pool.archived")`
- `"Close"` → `t("idea_pool.close")`
- `"Archive Idea"` → `t("idea_pool.archive_idea")`
- `"This idea has been archived."` → `t("idea_pool.archived_message")`

Read the full IdeaPool.tsx file first to find exact line numbers and any additional hardcoded strings not listed above. Replace ALL hardcoded user-facing English strings.
  </action>
  <verify>
1. `cd /Users/developer/eluma && npx tsc --noEmit -p client/tsconfig.json 2>&1 | head -20` -- should show zero errors
2. `grep -n '"[A-Z][a-z]' client/src/pages/IdeaPool.tsx | grep -v 'import\|//\|const\|type\|interface\|function\|console\|key='` -- should show no remaining hardcoded user-facing English strings in JSX
3. `grep -c 'TOOL_LABEL' client/src/components/AgentOutput.tsx` -- should reference TOOL_LABEL_KEYS (i18n keys) not TOOL_LABELS (hardcoded strings)
4. Verify locale files parse: `node -e "const en=require('./client/src/i18n/locales/en.json'); console.log(Object.keys(en.idea_pool)); console.log(Object.keys(en.agent.tool_label));"` -- should list all new keys
  </verify>
  <done>
AgentOutput.tsx tool labels use t("agent.tool_label.*") instead of hardcoded English strings. IdeaPool.tsx uses t("idea_pool.*") for all user-facing text. Both en.json and de.json contain the new agent.tool_label and idea_pool sections with all required keys.
  </done>
</task>

</tasks>

<verification>
1. Client TypeScript compiles cleanly: `cd /Users/developer/eluma && npx tsc --noEmit -p client/tsconfig.json` -- zero errors
2. Server gsd.ts import fixed: `grep '../workflow/definitions.js' server/src/routes/gsd.ts` -- matches
3. No hardcoded English nav labels: `grep -c 't("nav.' client/src/App.tsx` -- 8 matches
4. No hardcoded tool labels: TOOL_LABELS constant removed or replaced with i18n key map
5. No hardcoded IdeaPool strings: all user-facing text uses t() calls
6. Both locale files valid JSON: `node -e "require('./client/src/i18n/locales/en.json'); require('./client/src/i18n/locales/de.json'); console.log('OK')"`
</verification>

<success_criteria>
- gsd.ts compiles without import path error
- App.tsx navigation renders in German when German is the active language
- AgentOutput.tsx tool progress labels render in German when German is active
- IdeaPool.tsx renders fully in German when German is active
- Zero new TypeScript errors introduced
</success_criteria>

<output>
After completion, create `.planning/phases/21-stabilization/21-01-SUMMARY.md`
</output>
