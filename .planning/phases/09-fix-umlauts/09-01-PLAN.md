---
phase: 09-fix-umlauts
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - client/src/i18n/locales/de.json
  - server/src/i18n/server.ts
autonomous: true

must_haves:
  truths:
    - "User sees correct Unicode umlauts (ae->a with umlaut, oe->o with umlaut, ue->u with umlaut, ss->eszett) in all German UI text"
    - "Server-side German error messages use correct Unicode umlauts"
    - "All 434 translation keys remain intact after edits (no keys added or removed)"
    - "All {{variable}} interpolation tokens are preserved exactly"
    - "False-positive words (Dauer, dauern, Zeitdauer, Neue, Neues, neuen, Aktuelle, aktuelle, aktuellen) remain unchanged"
  artifacts:
    - path: "client/src/i18n/locales/de.json"
      provides: "All 434 German translation values with correct Unicode umlauts"
      contains: "Geschäftsvorfälle"
    - path: "server/src/i18n/server.ts"
      provides: "Server-side German translations with correct Unicode umlauts"
      contains: "Ungültige"
  key_links:
    - from: "client/src/i18n/locales/de.json"
      to: "client i18n system"
      via: "useTranslation() hook reads de.json values"
      pattern: "t\\("
    - from: "server/src/i18n/server.ts"
      to: "API error responses"
      via: "t() function returns German strings"
      pattern: "t\\(.*lang"
---

<objective>
Fix all ASCII umlaut approximations in German translations to use correct Unicode characters.

Purpose: German UI text currently shows "ae" instead of "ä", "oe" instead of "ö", "ue" instead of "ü", and "ss" instead of "ß" in ~126 of 434 translation values. This is unacceptable for a German-language product.

Output: Corrected `de.json` and `server.ts` with proper Unicode umlauts throughout.
</objective>

<execution_context>
@/Users/developer/.claude/get-shit-done/workflows/execute-plan.md
@/Users/developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@client/src/i18n/locales/de.json
@server/src/i18n/server.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix all ASCII umlaut approximations in de.json</name>
  <files>client/src/i18n/locales/de.json</files>
  <action>
Read `client/src/i18n/locales/de.json` (511 lines, 434 keys). Replace all ASCII umlaut approximations with correct Unicode characters in German translation VALUES only (never touch JSON keys).

Replacement rules (apply to values only):
1. `ue` -> `ü` when it represents an umlaut (e.g., "fuer" -> "für", "zurueck" -> "zurück", "hinzugefuegt" -> "hinzugefügt", "verfuegbar" -> "verfügbar", "Begruendung" -> "Begründung")
2. `Ue` -> `Ü` at word starts (e.g., "Ueberpruefung" -> "Überprüfung", "Ueberarbeiten" -> "Überarbeiten", "Uebereinstimmung" -> "Übereinstimmung")
3. `oe` -> `ö` when it represents an umlaut (e.g., "Loeschen" -> "Löschen", "loesende" -> "lösende", "koennten" -> "könnten", "noetig" -> "nötig", "moechten" -> "möchten")
4. `ae` -> `ä` when it represents an umlaut (e.g., "Aktivitaeten" -> "Aktivitäten", "Abhaengigkeiten" -> "Abhängigkeiten", "Faehigkeiten" -> "Fähigkeiten", "Schaetzung" -> "Schätzung", "Geschaetzte" -> "Geschätzte")
5. `ss` -> `ß` in specific words only: "abschliessen" -> "abschließen", "Grosses" -> "Großes", "Grosses Team" -> "Großes Team", "Gross" -> "Groß" (in "Gross" context, not "gross" as prefix to random words), "Massnahmen" -> "Maßnahmen", "regelmaessig" -> "regelmäßig" (after ae->ä fix becomes "regelmäßig")

CRITICAL false positives — do NOT change these words:
- "Dauer" (duration) — the "ue" is NOT an umlaut
- "dauern" (to last) — the "ue" is NOT an umlaut
- "Zeitdauer" (time duration) — the "ue" is NOT an umlaut
- "Neue" / "Neues" / "neuen" — the "ue" is NOT an umlaut
- "Aktuelle" / "aktuelle" / "aktuellen" — the "ue" is NOT an umlaut

CRITICAL preservation rules:
- All `{{variable}}` interpolation tokens (e.g., `{{count}}`, `{{name}}`, `{{phase}}`, `{{current}}`, `{{total}}`, `{{min}}`, `{{confidence}}`, `{{score}}`, `{{max}}`, `{{duration}}`, `{{username}}`, `{{member}}`) must remain EXACTLY as they are
- All JSON keys must remain unchanged
- The JSON structure must remain valid
- The total number of leaf keys must remain exactly 434

Approach: Read the entire file, make all corrections systematically section by section, write the corrected file. After writing, validate JSON is parseable and key count is still 434.

Note on "ss" -> "ß": Only apply where linguistically correct. The word "Passwort" stays as "Passwort" (it is correct German). The word "Passkey" stays as "Passkey" (English loanword). Words like "abschliessen", "Grosses", "Massnahmen" do get ß. The word "Ergebnis" / "Ergebnisse" stays with ss (correct German). "Einfluss" stays with ss (correct German).
  </action>
  <verify>
1. Run: `cd /Users/developer/eluma && python3 -c "import json; data=json.load(open('client/src/i18n/locales/de.json')); print('Valid JSON')"` — must print "Valid JSON"
2. Run: `cd /Users/developer/eluma && python3 -c "
import json
data=json.load(open('client/src/i18n/locales/de.json'))
def count(o):
    c=0
    for v in o.values():
        c+=count(v) if isinstance(v,dict) else 1
    return c
print(f'Keys: {count(data)}')"` — must print "Keys: 434"
3. Run: `cd /Users/developer/eluma && grep -c 'oeschen\|zurueck\|Zurueck\|fuegt\|Bestaetigen\|Loeschen\|Ueberpruefung\|Ungueltige\|Aktivitaeten\|verfuegbar' client/src/i18n/locales/de.json` — must return 0
4. Run: `cd /Users/developer/eluma && grep -c 'Dauer\|Neue\|Aktuelle' client/src/i18n/locales/de.json` — must return > 0 (false positives preserved)
5. Run: `cd /Users/developer/eluma && grep -c '{{' client/src/i18n/locales/de.json` — count must match original (18 interpolation tokens)
  </verify>
  <done>All 126 ASCII umlaut approximations in de.json are replaced with correct Unicode characters. JSON is valid, 434 keys preserved, all interpolation tokens intact, all false-positive words unchanged.</done>
</task>

<task type="auto">
  <name>Task 2: Fix ASCII umlaut approximations in server.ts</name>
  <files>server/src/i18n/server.ts</files>
  <action>
Read `server/src/i18n/server.ts` (49 lines). Fix the 2 German strings in the `de` translations object:

1. Line 10: `"Ungueltige Anmeldedaten"` -> `"Ungültige Anmeldedaten"`
2. Line 17: `"Ungueltige Anfrage"` -> `"Ungültige Anfrage"`

No other changes needed. The remaining German strings in this file already use correct characters ("Nicht gefunden", "Nicht autorisiert", "Zugriff verweigert", "Interner Serverfehler", "Validierungsfehler", "Benutzername ist bereits vergeben").
  </action>
  <verify>
1. Run: `cd /Users/developer/eluma && grep 'Ungueltige' server/src/i18n/server.ts` — must return empty (no matches)
2. Run: `cd /Users/developer/eluma && grep 'Ungültige' server/src/i18n/server.ts` — must return 2 matches
3. Run: `cd /Users/developer/eluma && npx tsc --noEmit server/src/i18n/server.ts 2>&1 || echo "Type check done"` — must not show type errors for this file
  </verify>
  <done>Both German strings in server.ts use correct Unicode umlauts: "Ungültige Anmeldedaten" and "Ungültige Anfrage".</done>
</task>

</tasks>

<verification>
After both tasks complete:

1. JSON validity: `de.json` parses without errors
2. Key count: Exactly 434 leaf keys in `de.json` (unchanged)
3. Zero ASCII approximations: `grep -cP '(?<!n)ue(?!r|s\b)|(?<![N])oe|(?<![D])ae|Ungueltige' client/src/i18n/locales/de.json server/src/i18n/server.ts` returns 0 for umlaut patterns (accounting for false positives)
4. False positives preserved: "Dauer", "Neue", "Aktuelle" still present unchanged
5. Interpolation tokens: All `{{variable}}` tokens preserved
6. TypeScript compiles: No type errors introduced in server.ts
</verification>

<success_criteria>
1. User sees "Löschen" not "Loeschen", "Zurück" not "Zurueck", "Bestätigen" not "Bestaetigen" in German UI
2. User sees "Geschätzte" not "Geschaetzte", "Abhängigkeiten" not "Abhaengigkeiten" in German UI
3. User sees "Überprüfung" not "Ueberpruefung", "Übereinstimmung" not "Uebereinstimmung" in German UI
4. Server returns "Ungültige Anmeldedaten" not "Ungueltige Anmeldedaten" for auth errors
5. All 434 translation keys remain functional with no missing or broken entries
</success_criteria>

<output>
After completion, create `.planning/phases/09-fix-umlauts/09-01-SUMMARY.md`
</output>
